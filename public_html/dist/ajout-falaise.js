import{d as P,r as v,f as k,x as z,O as R,c as g,o as b,a as p,w as L,F as _,b as A,j as F,n as D,t as j,g as K,m as q,P as T,k as C,l as J,N as B}from"./chunks/runtime-dom.esm-bundler-CvJMXt7Z.js";import{_ as Q}from"./chunks/FormAutocomplete.vue_vue_type_script_setup_true_lang-t-v9WMV7.js";import{_ as G}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";import"./chunks/Autocomplete.vue_vue_type_script_setup_true_lang-B-Tf6Nrb.js";const H=["name","value","required"],W={class:"flex flex-wrap items-center gap-1 flex-grow"},X=["onClick"],Y=["placeholder","disabled"],Z={class:"flex items-center gap-1"},ee=["disabled"],te=["disabled"],le={class:"absolute top-full left-0 w-full z-50 bg-white border border-base-300 rounded-lg shadow-lg mt-1 flex flex-wrap p-1"},ae=["onClick"],ne=P({__name:"MultiSelect",props:{modelValue:{},options:{},name:{},placeholder:{default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},showSelectAll:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(t,{emit:u}){const s=t,n=u,r=v(""),o=v(!1),N=v(null),i=v(null),y=k(()=>new Set(s.modelValue)),S=k(()=>s.options.filter(e=>y.value.has(e.value))),d=k(()=>{const e=s.options.filter(a=>!y.value.has(a.value));if(!r.value)return e;const l=r.value.toUpperCase();return e.filter(a=>a.label.toUpperCase().includes(l))}),E=k(()=>s.modelValue.join(","));function c(e){var a;const l=[...s.modelValue,e.value];n("update:modelValue",l),n("change",l),r.value="",(a=i.value)==null||a.focus()}function f(e){if(s.disabled)return;const l=s.modelValue.filter(a=>a!==e.value);n("update:modelValue",l),n("change",l)}function m(){var l;const e=s.options.map(a=>a.value);n("update:modelValue",e),n("change",e),o.value=!1,r.value="",(l=i.value)==null||l.focus()}function x(e){var l;e.stopPropagation(),n("update:modelValue",[]),n("change",[]),r.value="",(l=i.value)==null||l.focus()}function w(){var e;s.disabled||(o.value=!0,(e=i.value)==null||e.focus())}function h(e){(e.key==="Enter"||e.key==="NumpadEnter")&&r.value&&d.value.length>0&&c(d.value[0])}function V(e){N.value&&!N.value.contains(e.target)&&(o.value=!1)}return z(()=>{document.addEventListener("click",V)}),R(()=>{document.removeEventListener("click",V)}),(e,l)=>(b(),g("div",{ref_key:"containerRef",ref:N,class:"multi-select-container relative"},[p("input",{type:"hidden",name:t.name,value:E.value,required:t.required&&t.modelValue.length===0},null,8,H),p("div",{class:D(["input input-primary input-sm flex items-center flex-wrap gap-1 h-auto min-h-8 cursor-text",{"input-disabled":t.disabled}]),onClick:w},[p("div",W,[(b(!0),g(_,null,A(S.value,a=>(b(),g("span",{key:a.value,class:D(["badge badge-info text-white badge-sm px-2 py-1 cursor-pointer select-none",{"cursor-not-allowed":t.disabled}]),onClick:F(O=>f(a),["stop"])},j(a.label),11,X))),128)),L(p("input",{ref_key:"searchInputRef",ref:i,"onUpdate:modelValue":l[0]||(l[0]=a=>r.value=a),type:"text",class:"flex-grow min-w-[40px] border-0 outline-none bg-transparent text-sm",placeholder:S.value.length===0?t.placeholder:"",disabled:t.disabled,onKeyup:h,onFocus:l[1]||(l[1]=a=>o.value=!0)},null,40,Y),[[K,r.value]])]),p("div",Z,[t.showSelectAll&&d.value.length>0?(b(),g("button",{key:0,type:"button",class:"btn btn-xs btn-ghost p-1",title:"Tout",disabled:t.disabled,onClick:F(m,["stop"])},[...l[2]||(l[2]=[p("svg",{class:"w-4 h-4 fill-current"},[p("use",{href:"/symbols/icons.svg#ri-check-double-line"})],-1)])],8,ee)):q("",!0),S.value.length>0?(b(),g("button",{key:1,type:"button",class:"btn btn-xs btn-ghost p-1",title:"Clear Selection",disabled:t.disabled,onClick:x},[...l[3]||(l[3]=[p("svg",{class:"w-4 h-4 fill-current"},[p("use",{href:"/symbols/icons.svg#ri-close-line"})],-1)])],8,te)):q("",!0)])],2),L(p("div",le,[(b(!0),g(_,null,A(d.value,a=>(b(),g("div",{key:a.value,class:"badge badge-info text-white m-1 px-2 py-1 cursor-pointer select-none hover:badge-primary",onClick:O=>c(a)},j(a.label),9,ae))),128))],512),[[T,o.value&&d.value.length>0]])],512))}}),U=G(ne,[["__scopeId","data-v-364fe0e2"]]),M=[{value:"'N'",label:"N"},{value:"'S'",label:"S"},{value:"'E'",label:"E"},{value:"'O'",label:"O"},{value:"'NE'",label:"NE"},{value:"'NO'",label:"NO"},{value:"'SE'",label:"SE"},{value:"'SO'",label:"SO"},{value:"'NNE'",label:"NNE"},{value:"'NNO'",label:"NNO"},{value:"'SSE'",label:"SSE"},{value:"'SSO'",label:"SSO"},{value:"'ENE'",label:"ENE"},{value:"'ESE'",label:"ESE"},{value:"'OSO'",label:"OSO"},{value:"'ONO'",label:"ONO"}];document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("vue-ajout-falaise");if(!t){console.warn("[velogrimpe] #vue-ajout-falaise mount point not found");return}let u=[],s=!1,n=null;try{u=JSON.parse(t.dataset.falaises||"[]"),s=t.dataset.admin==="true",n=t.dataset.presetFalaiseId?parseInt(t.dataset.presetFalaiseId,10):null}catch(i){console.error("[velogrimpe] Failed to parse ajout-falaise data:",i)}const r=i=>i.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,255),o=i=>{typeof window.fetchAndPrefillData=="function"&&window.fetchAndPrefillData(i)};C({setup(){const i=v(""),y=v(n!==null);n&&(y.value=!0);const S=(d,E)=>{var l,a,O;const c=document.getElementById("confirmButton"),f=document.getElementById("falaiseExistsAlert"),m=document.getElementById("falaiseEditInfo"),x=document.getElementById("falaise_id"),w=document.getElementById("falaise_nomformate"),h=document.getElementById("falaise_latlng"),V=document.getElementById("linkSelectedFalaise");if(c&&(c.textContent="Ajouter la falaise"),!E){f&&f.classList.add("hidden"),m&&m.classList.add("hidden");return}const e=u.find($=>$.nom.toLowerCase()===E.toLowerCase());e?((l=document.getElementById("falaise_img1_preview"))==null||l.classList.add("hidden"),(a=document.getElementById("falaise_img2_preview"))==null||a.classList.add("hidden"),(O=document.getElementById("falaise_img3_preview"))==null||O.classList.add("hidden"),h&&e.latlng&&(h.value=e.latlng),w&&e.nomformate&&(w.value=e.nomformate),h==null||h.dispatchEvent(new Event("input")),e.status==="verrouillée"?(f&&f.classList.remove("hidden"),m&&m.classList.add("hidden"),V&&(V.href=`/falaise.php?falaise_id=${e.id}`),s&&o(e.id)):(f&&f.classList.add("hidden"),m&&m.classList.remove("hidden"),x&&(x.value=String(e.id)),o(e.id))):(f&&f.classList.add("hidden"),m&&m.classList.add("hidden"),w&&(w.value=r(E)),x&&(x.value=""))};return J(i,d=>{if(!u.find(c=>c.nom.toLowerCase()===d.toLowerCase())){const c=document.getElementById("falaise_nomformate");c&&(c.value=r(d))}}),()=>B(Q,{modelValue:i.value,"onUpdate:modelValue":d=>{i.value=d},items:u.map(d=>({...d,nom:d.nom})),acceptNewValue:!0,disabled:y.value,onSelect:S})}}).mount(t),console.log("[velogrimpe] Vue ajout-falaise autocomplete mounted"),se()});function I(t){return t?t.split(",").map(u=>u.trim()).filter(u=>u.length>0):[]}function se(){const t=document.getElementById("vue-exposhort1");if(t){const s=t.dataset.value||"",n=v(I(s));C({setup(){return()=>B(U,{modelValue:n.value,"onUpdate:modelValue":o=>{n.value=o},options:M,name:"falaise_exposhort1",required:!0,placeholder:"Sélectionner..."})}}).mount(t),window.setExpo1Value=o=>{n.value=I(o)}}const u=document.getElementById("vue-exposhort2");if(u){const s=u.dataset.value||"",n=v(I(s));C({setup(){return()=>B(U,{modelValue:n.value,"onUpdate:modelValue":o=>{n.value=o},options:M,name:"falaise_exposhort2",required:!1,placeholder:"Sélectionner..."})}}).mount(u),window.setExpo2Value=o=>{n.value=I(o)}}}
