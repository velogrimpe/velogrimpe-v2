import{d as M,r as v,f as O,x as $,O as P,c as x,o as w,a as h,w as B,m as z,F as L,b as A,j as R,n as F,t as D,g as K,P as J,k,l as Q,N as C}from"./chunks/runtime-dom.esm-bundler-CvJMXt7Z.js";import{_ as T}from"./chunks/FormAutocomplete.vue_vue_type_script_setup_true_lang-t-v9WMV7.js";import{_ as G}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";import"./chunks/Autocomplete.vue_vue_type_script_setup_true_lang-B-Tf6Nrb.js";const H=["name","value","required"],W={class:"flex items-center gap-1 flex-grow min-w-0 overflow-hidden"},X=["onClick"],Y=["placeholder","disabled"],Z=["disabled"],ee={class:"absolute top-full left-0 w-full z-50 bg-white border border-base-300 rounded-lg shadow-lg mt-1 flex flex-wrap p-1"},te=["onClick"],le=M({__name:"MultiSelect",props:{modelValue:{},options:{},name:{},placeholder:{default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(t,{emit:i}){const s=t,n=i,r=v(""),o=v(!1),V=v(null),u=v(null),y=O(()=>new Set(s.modelValue)),S=O(()=>s.options.filter(l=>y.value.has(l.value))),d=O(()=>{const l=s.options.filter(a=>!y.value.has(a.value));if(!r.value)return l;const e=r.value.toUpperCase();return l.filter(a=>a.label.toUpperCase().includes(e))}),g=O(()=>s.modelValue.join(","));function c(l){var a;const e=[...s.modelValue,l.value];n("update:modelValue",e),n("change",e),r.value="",(a=u.value)==null||a.focus()}function f(l){if(s.disabled)return;const e=s.modelValue.filter(a=>a!==l.value);n("update:modelValue",e),n("change",e)}function m(l){var e;l.stopPropagation(),n("update:modelValue",[]),n("change",[]),r.value="",(e=u.value)==null||e.focus()}function b(){var l;s.disabled||(o.value=!0,(l=u.value)==null||l.focus())}function E(l){(l.key==="Enter"||l.key==="NumpadEnter")&&r.value&&d.value.length>0&&c(d.value[0])}function p(l){V.value&&!V.value.contains(l.target)&&(o.value=!1)}return $(()=>{document.addEventListener("click",p)}),P(()=>{document.removeEventListener("click",p)}),(l,e)=>(w(),x("div",{ref_key:"containerRef",ref:V,class:"multi-select-container relative"},[h("input",{type:"hidden",name:t.name,value:g.value,required:t.required&&t.modelValue.length===0},null,8,H),h("div",{class:F(["input input-primary input-sm flex items-center h-auto min-h-8 cursor-text py-1 pr-1",{"input-disabled":t.disabled}]),onClick:b},[h("div",W,[(w(!0),x(L,null,A(S.value,a=>(w(),x("span",{key:a.value,class:F(["badge badge-info text-white badge-sm cursor-pointer select-none",{"cursor-not-allowed":t.disabled}]),onClick:R(N=>f(a),["stop"])},D(a.label),11,X))),128)),B(h("input",{ref_key:"searchInputRef",ref:u,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a),type:"text",class:"flex-grow min-w-[8px] border-0 outline-none bg-transparent text-sm h-5",placeholder:S.value.length===0?t.placeholder:"",disabled:t.disabled,onKeyup:E,onFocus:e[1]||(e[1]=a=>o.value=!0)},null,40,Y),[[K,r.value]])]),S.value.length>0?(w(),x("button",{key:0,type:"button",class:"btn btn-xs btn-ghost p-0 h-5 min-h-0 shrink-0 ml-1",title:"Clear Selection",disabled:t.disabled,onClick:m},[...e[2]||(e[2]=[h("svg",{class:"w-4 h-4 fill-current"},[h("use",{href:"/symbols/icons.svg#ri-close-line"})],-1)])],8,Z)):z("",!0)],2),B(h("div",ee,[(w(!0),x(L,null,A(d.value,a=>(w(),x("div",{key:a.value,class:"badge badge-info text-white m-1 px-2 py-1 cursor-pointer select-none hover:badge-primary",onClick:N=>c(a)},D(a.label),9,te))),128))],512),[[J,o.value&&d.value.length>0]])],512))}}),j=G(le,[["__scopeId","data-v-925e1fba"]]),q=[{value:"'N'",label:"N"},{value:"'S'",label:"S"},{value:"'E'",label:"E"},{value:"'O'",label:"O"},{value:"'NE'",label:"NE"},{value:"'NO'",label:"NO"},{value:"'SE'",label:"SE"},{value:"'SO'",label:"SO"},{value:"'NNE'",label:"NNE"},{value:"'NNO'",label:"NNO"},{value:"'SSE'",label:"SSE"},{value:"'SSO'",label:"SSO"},{value:"'ENE'",label:"ENE"},{value:"'ESE'",label:"ESE"},{value:"'OSO'",label:"OSO"},{value:"'ONO'",label:"ONO"}];document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("vue-ajout-falaise");if(!t){console.warn("[velogrimpe] #vue-ajout-falaise mount point not found");return}let i=[],s=!1,n=null;try{i=JSON.parse(t.dataset.falaises||"[]"),s=t.dataset.admin==="true",n=t.dataset.presetFalaiseId?parseInt(t.dataset.presetFalaiseId,10):null}catch(u){console.error("[velogrimpe] Failed to parse ajout-falaise data:",u)}const r=u=>u.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,255),o=u=>{typeof window.fetchAndPrefillData=="function"&&window.fetchAndPrefillData(u)};k({setup(){const u=v(""),y=v(n!==null);n&&(y.value=!0);const S=(d,g)=>{var a,N,_;const c=document.getElementById("confirmButton"),f=document.getElementById("falaiseExistsAlert"),m=document.getElementById("falaiseEditInfo"),b=document.getElementById("falaise_id"),E=document.getElementById("falaise_nomformate"),p=document.getElementById("falaise_latlng"),l=document.getElementById("linkSelectedFalaise");if(c&&(c.textContent="Ajouter la falaise"),!g){f&&f.classList.add("hidden"),m&&m.classList.add("hidden");return}const e=i.find(U=>U.nom.toLowerCase()===g.toLowerCase());e?((a=document.getElementById("falaise_img1_preview"))==null||a.classList.add("hidden"),(N=document.getElementById("falaise_img2_preview"))==null||N.classList.add("hidden"),(_=document.getElementById("falaise_img3_preview"))==null||_.classList.add("hidden"),p&&e.latlng&&(p.value=e.latlng),E&&e.nomformate&&(E.value=e.nomformate),p==null||p.dispatchEvent(new Event("input")),e.status==="verrouillée"?(f&&f.classList.remove("hidden"),m&&m.classList.add("hidden"),l&&(l.href=`/falaise.php?falaise_id=${e.id}`),s&&o(e.id)):(f&&f.classList.add("hidden"),m&&m.classList.remove("hidden"),b&&(b.value=String(e.id)),o(e.id))):(f&&f.classList.add("hidden"),m&&m.classList.add("hidden"),E&&(E.value=r(g)),b&&(b.value=""))};return Q(u,d=>{if(!i.find(c=>c.nom.toLowerCase()===d.toLowerCase())){const c=document.getElementById("falaise_nomformate");c&&(c.value=r(d))}}),()=>C(T,{modelValue:u.value,"onUpdate:modelValue":d=>{u.value=d},items:i.map(d=>({...d,nom:d.nom})),acceptNewValue:!0,disabled:y.value,onSelect:S})}}).mount(t),console.log("[velogrimpe] Vue ajout-falaise autocomplete mounted"),ae()});function I(t){return t?t.split(",").map(i=>i.trim()).filter(i=>i.length>0):[]}function ae(){const t=document.getElementById("vue-exposhort1");if(t){const s=t.dataset.value||"",n=v(I(s));k({setup(){return()=>C(j,{modelValue:n.value,"onUpdate:modelValue":o=>{n.value=o},options:q,name:"falaise_exposhort1",required:!0,placeholder:"Sélectionner..."})}}).mount(t),window.setExpo1Value=o=>{n.value=I(o)}}const i=document.getElementById("vue-exposhort2");if(i){const s=i.dataset.value||"",n=v(I(s));k({setup(){return()=>C(j,{modelValue:n.value,"onUpdate:modelValue":o=>{n.value=o},options:q,name:"falaise_exposhort2",required:!1,placeholder:"Sélectionner..."})}}).mount(i),window.setExpo2Value=o=>{n.value=I(o)}}}
