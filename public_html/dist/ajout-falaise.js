import{d as M,r as v,f as O,x as $,O as P,c as E,o as x,a as y,w as L,m as z,F as _,b as A,j as R,n as F,t as D,g as K,P as J,k as I,l as Q,N as C}from"./chunks/runtime-dom.esm-bundler-CvJMXt7Z.js";import{_ as T}from"./chunks/FormAutocomplete.vue_vue_type_script_setup_true_lang-t-v9WMV7.js";import{_ as G}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";import"./chunks/Autocomplete.vue_vue_type_script_setup_true_lang-B-Tf6Nrb.js";const H=["name","value","required"],W=["onClick"],X=["placeholder","disabled"],Y=["disabled"],Z={class:"absolute top-full left-0 w-full z-50 bg-white border border-base-300 rounded-lg shadow-lg mt-1 flex flex-wrap p-1"},ee=["onClick"],te=M({__name:"MultiSelect",props:{modelValue:{},options:{},name:{},placeholder:{default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(t,{emit:i}){const s=t,n=i,r=v(""),o=v(!1),V=v(null),u=v(null),w=O(()=>new Set(s.modelValue)),S=O(()=>s.options.filter(a=>w.value.has(a.value))),d=O(()=>{const a=s.options.filter(l=>!w.value.has(l.value));if(!r.value)return a;const e=r.value.toUpperCase();return a.filter(l=>l.label.toUpperCase().includes(e))}),h=O(()=>s.modelValue.join(","));function c(a){var l;const e=[...s.modelValue,a.value];n("update:modelValue",e),n("change",e),r.value="",(l=u.value)==null||l.focus()}function f(a){if(s.disabled)return;const e=s.modelValue.filter(l=>l!==a.value);n("update:modelValue",e),n("change",e)}function m(a){var e;a.stopPropagation(),n("update:modelValue",[]),n("change",[]),r.value="",(e=u.value)==null||e.focus()}function g(){var a;s.disabled||(o.value=!0,(a=u.value)==null||a.focus())}function b(a){(a.key==="Enter"||a.key==="NumpadEnter")&&r.value&&d.value.length>0&&c(d.value[0])}function p(a){V.value&&!V.value.contains(a.target)&&(o.value=!1)}return $(()=>{document.addEventListener("click",p)}),P(()=>{document.removeEventListener("click",p)}),(a,e)=>(x(),E("div",{ref_key:"containerRef",ref:V,class:"multi-select-container relative"},[y("input",{type:"hidden",name:t.name,value:h.value,required:t.required&&t.modelValue.length===0},null,8,H),y("div",{class:F(["input input-primary input-sm flex items-center gap-1 h-auto min-h-8 cursor-text py-1",{"input-disabled":t.disabled}]),onClick:g},[(x(!0),E(_,null,A(S.value,l=>(x(),E("span",{key:l.value,class:F(["badge badge-info text-white badge-sm cursor-pointer select-none shrink-0",{"cursor-not-allowed":t.disabled}]),onClick:R(N=>f(l),["stop"])},D(l.label),11,W))),128)),L(y("input",{ref_key:"searchInputRef",ref:u,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value=l),type:"text",class:"flex-grow min-w-[30px] border-0 outline-none bg-transparent text-sm h-5",placeholder:S.value.length===0?t.placeholder:"",disabled:t.disabled,onKeyup:b,onFocus:e[1]||(e[1]=l=>o.value=!0)},null,40,X),[[K,r.value]]),S.value.length>0?(x(),E("button",{key:0,type:"button",class:"btn btn-xs btn-ghost p-0 h-5 min-h-0 shrink-0",title:"Clear Selection",disabled:t.disabled,onClick:m},[...e[2]||(e[2]=[y("svg",{class:"w-4 h-4 fill-current"},[y("use",{href:"/symbols/icons.svg#ri-close-line"})],-1)])],8,Y)):z("",!0)],2),L(y("div",Z,[(x(!0),E(_,null,A(d.value,l=>(x(),E("div",{key:l.value,class:"badge badge-info text-white m-1 px-2 py-1 cursor-pointer select-none hover:badge-primary",onClick:N=>c(l)},D(l.label),9,ee))),128))],512),[[J,o.value&&d.value.length>0]])],512))}}),j=G(te,[["__scopeId","data-v-f1183072"]]),q=[{value:"'N'",label:"N"},{value:"'S'",label:"S"},{value:"'E'",label:"E"},{value:"'O'",label:"O"},{value:"'NE'",label:"NE"},{value:"'NO'",label:"NO"},{value:"'SE'",label:"SE"},{value:"'SO'",label:"SO"},{value:"'NNE'",label:"NNE"},{value:"'NNO'",label:"NNO"},{value:"'SSE'",label:"SSE"},{value:"'SSO'",label:"SSO"},{value:"'ENE'",label:"ENE"},{value:"'ESE'",label:"ESE"},{value:"'OSO'",label:"OSO"},{value:"'ONO'",label:"ONO"}];document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("vue-ajout-falaise");if(!t){console.warn("[velogrimpe] #vue-ajout-falaise mount point not found");return}let i=[],s=!1,n=null;try{i=JSON.parse(t.dataset.falaises||"[]"),s=t.dataset.admin==="true",n=t.dataset.presetFalaiseId?parseInt(t.dataset.presetFalaiseId,10):null}catch(u){console.error("[velogrimpe] Failed to parse ajout-falaise data:",u)}const r=u=>u.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,255),o=u=>{typeof window.fetchAndPrefillData=="function"&&window.fetchAndPrefillData(u)};I({setup(){const u=v(""),w=v(n!==null);n&&(w.value=!0);const S=(d,h)=>{var l,N,B;const c=document.getElementById("confirmButton"),f=document.getElementById("falaiseExistsAlert"),m=document.getElementById("falaiseEditInfo"),g=document.getElementById("falaise_id"),b=document.getElementById("falaise_nomformate"),p=document.getElementById("falaise_latlng"),a=document.getElementById("linkSelectedFalaise");if(c&&(c.textContent="Ajouter la falaise"),!h){f&&f.classList.add("hidden"),m&&m.classList.add("hidden");return}const e=i.find(U=>U.nom.toLowerCase()===h.toLowerCase());e?((l=document.getElementById("falaise_img1_preview"))==null||l.classList.add("hidden"),(N=document.getElementById("falaise_img2_preview"))==null||N.classList.add("hidden"),(B=document.getElementById("falaise_img3_preview"))==null||B.classList.add("hidden"),p&&e.latlng&&(p.value=e.latlng),b&&e.nomformate&&(b.value=e.nomformate),p==null||p.dispatchEvent(new Event("input")),e.status==="verrouillée"?(f&&f.classList.remove("hidden"),m&&m.classList.add("hidden"),a&&(a.href=`/falaise.php?falaise_id=${e.id}`),s&&o(e.id)):(f&&f.classList.add("hidden"),m&&m.classList.remove("hidden"),g&&(g.value=String(e.id)),o(e.id))):(f&&f.classList.add("hidden"),m&&m.classList.add("hidden"),b&&(b.value=r(h)),g&&(g.value=""))};return Q(u,d=>{if(!i.find(c=>c.nom.toLowerCase()===d.toLowerCase())){const c=document.getElementById("falaise_nomformate");c&&(c.value=r(d))}}),()=>C(T,{modelValue:u.value,"onUpdate:modelValue":d=>{u.value=d},items:i.map(d=>({...d,nom:d.nom})),acceptNewValue:!0,disabled:w.value,onSelect:S})}}).mount(t),console.log("[velogrimpe] Vue ajout-falaise autocomplete mounted"),ae()});function k(t){return t?t.split(",").map(i=>i.trim()).filter(i=>i.length>0):[]}function ae(){const t=document.getElementById("vue-exposhort1");if(t){const s=t.dataset.value||"",n=v(k(s));I({setup(){return()=>C(j,{modelValue:n.value,"onUpdate:modelValue":o=>{n.value=o},options:q,name:"falaise_exposhort1",required:!0,placeholder:"Sélectionner..."})}}).mount(t),window.setExpo1Value=o=>{n.value=k(o)}}const i=document.getElementById("vue-exposhort2");if(i){const s=i.dataset.value||"",n=v(k(s));I({setup(){return()=>C(j,{modelValue:n.value,"onUpdate:modelValue":o=>{n.value=o},options:q,name:"falaise_exposhort2",required:!1,placeholder:"Sélectionner..."})}}).mount(i),window.setExpo2Value=o=>{n.value=k(o)}}}
