import{d as P,r as O,f as y,x as T,O as G,c as x,o as b,a as g,w as D,m as H,F as A,b as M,j as W,n as j,t as z,g as X,P as Y,k as L,l as Z,N as $}from"./chunks/runtime-dom.esm-bundler-CvJMXt7Z.js";import{_ as ee}from"./chunks/FormAutocomplete.vue_vue_type_script_setup_true_lang-t-v9WMV7.js";import{_ as K}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";import"./chunks/Autocomplete.vue_vue_type_script_setup_true_lang-B-Tf6Nrb.js";const te=["name","value","required"],ae={class:"flex items-center gap-1 flex-grow min-w-0 overflow-hidden"},ne=["onClick"],le=["placeholder","disabled"],oe=["disabled"],se={class:"absolute top-full left-0 w-full z-50 bg-white border border-base-300 rounded-lg shadow-lg mt-1 flex flex-wrap p-1"},ie=["onClick"],re=P({__name:"MultiSelect",props:{modelValue:{},options:{},name:{},placeholder:{default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(l,{emit:c}){const u=l,i=c,f=O(""),m=O(!1),w=O(null),d=O(null),E=y(()=>new Set(u.modelValue)),N=y(()=>u.options.filter(o=>E.value.has(o.value))),r=y(()=>{const o=u.options.filter(s=>!E.value.has(s.value));if(!f.value)return o;const a=f.value.toUpperCase();return o.filter(s=>s.label.toUpperCase().includes(a))}),S=y(()=>u.modelValue.join(","));function p(o){var s;const a=[...u.modelValue,o.value];i("update:modelValue",a),i("change",a),f.value="",(s=d.value)==null||s.focus()}function t(o){if(u.disabled)return;const a=u.modelValue.filter(s=>s!==o.value);i("update:modelValue",a),i("change",a)}function e(o){var a;o.stopPropagation(),i("update:modelValue",[]),i("change",[]),f.value="",(a=d.value)==null||a.focus()}function n(){var o;u.disabled||(m.value=!0,(o=d.value)==null||o.focus())}function h(o){(o.key==="Enter"||o.key==="NumpadEnter")&&f.value&&r.value.length>0&&p(r.value[0])}function v(o){w.value&&!w.value.contains(o.target)&&(m.value=!1)}return T(()=>{document.addEventListener("click",v)}),G(()=>{document.removeEventListener("click",v)}),(o,a)=>(b(),x("div",{ref_key:"containerRef",ref:w,class:"multi-select-container relative"},[g("input",{type:"hidden",name:l.name,value:S.value,required:l.required&&l.modelValue.length===0},null,8,te),g("div",{class:j(["input input-primary input-sm flex items-center h-auto min-h-8 cursor-text py-1 pr-1",{"input-disabled":l.disabled}]),onClick:n},[g("div",ae,[(b(!0),x(A,null,M(N.value,s=>(b(),x("span",{key:s.value,class:j(["badge badge-info text-white badge-sm cursor-pointer select-none",{"cursor-not-allowed":l.disabled}]),onClick:W(V=>t(s),["stop"])},z(s.label),11,ne))),128)),D(g("input",{ref_key:"searchInputRef",ref:d,"onUpdate:modelValue":a[0]||(a[0]=s=>f.value=s),type:"text",class:"flex-grow min-w-[8px] border-0 outline-none bg-transparent text-sm h-5",placeholder:N.value.length===0?l.placeholder:"",disabled:l.disabled,onKeyup:h,onFocus:a[1]||(a[1]=s=>m.value=!0)},null,40,le),[[X,f.value]])]),N.value.length>0?(b(),x("button",{key:0,type:"button",class:"btn btn-xs btn-ghost p-0 h-5 min-h-0 shrink-0 ml-1",title:"Clear Selection",disabled:l.disabled,onClick:e},[...a[2]||(a[2]=[g("svg",{class:"w-4 h-4 fill-current"},[g("use",{href:"/symbols/icons.svg#ri-close-line"})],-1)])],8,oe)):H("",!0)],2),D(g("div",se,[(b(!0),x(A,null,M(r.value,s=>(b(),x("div",{key:s.value,class:"badge badge-info text-white m-1 px-2 py-1 cursor-pointer select-none hover:badge-primary",onClick:V=>p(s)},z(s.label),9,ie))),128))],512),[[Y,m.value&&r.value.length>0]])],512))}}),q=K(re,[["__scopeId","data-v-925e1fba"]]),ue=["width","height"],de=["points","fill","stroke"],ce=["points","fill","stroke"],fe=["r","fill"],k=120,R=16,me=P({__name:"RoseDesVents",props:{expo1:{},expo2:{default:""},size:{default:60}},setup(l){const c=l,u=["E","ESE","SE","SSE","S","SSO","SO","OSO","O","ONO","NO","NNO","N","NNE","NE","ENE"];function i(t){if(!t)return new Set;const e=t.replace(/'/g,"").split(",").map(n=>n.trim()).filter(Boolean);return new Set(e)}function f(t){const e=[{name:"ESE",needs:["E","SE"]},{name:"SSE",needs:["SE","S"]},{name:"SSO",needs:["S","SO"]},{name:"OSO",needs:["SO","O"]},{name:"ONO",needs:["O","NO"]},{name:"NNO",needs:["NO","N"]},{name:"NNE",needs:["N","NE"]},{name:"ENE",needs:["NE","E"]}],n=new Set;for(const h of e)h.needs.every(v=>t.has(v))&&n.add(h.name);return n}const m=y(()=>{const t=i(c.expo1),e=f(t);return new Set([...t,...e])}),w=y(()=>{const t=i(c.expo2),e=f(t);return new Set([...t,...e])}),d=k*.6,E=2*Math.PI/R,N=y(()=>{const t=[];for(let e=0;e<R;e++){const n=e*E,h=n+E/2,v=n+E,o=e%4===0?k:e%2===0?k*.9:k*.75,a=(e+1)%4===0?k:(e+1)%2===0?k*.9:k*.75,s=Math.cos(n)*o,V=Math.sin(n)*o,_=Math.cos(h)*d,C=Math.sin(h)*d,J=Math.cos(v)*a,Q=Math.sin(v)*a;t.push({direction:u[e],path1:`0,0 ${s.toFixed(2)},${V.toFixed(2)} ${_.toFixed(2)},${C.toFixed(2)}`,path2:`0,0 ${J.toFixed(2)},${Q.toFixed(2)} ${_.toFixed(2)},${C.toFixed(2)}`})}return t}),r={primary:"#1e5d3e",primaryStroke:"#2e8b57",secondary:"rgba(30, 93, 62, 0.5)",secondaryStroke:"rgba(46, 139, 87, 0.5)",inactive:"#eee",inactiveStroke:"#bbb"};function S(t,e){const n=e?u[(u.indexOf(t)+1)%16]:t;return m.value.has(n)?r.primary:w.value.has(n)?r.secondary:r.inactive}function p(t,e){const n=e?u[(u.indexOf(t)+1)%16]:t;return m.value.has(n)?r.primaryStroke:w.value.has(n)?r.secondaryStroke:r.inactiveStroke}return(t,e)=>(b(),x("svg",{width:l.size,height:l.size,viewBox:"-150 -150 300 300",class:"rose-des-vents"},[(b(!0),x(A,null,M(N.value,n=>(b(),x(A,{key:n.direction},[g("polygon",{points:n.path1,fill:S(n.direction,!1),stroke:p(n.direction,!1),"stroke-width":"1"},null,8,de),g("polygon",{points:n.path2,fill:S(n.direction,!0),stroke:p(n.direction,!0),"stroke-width":"1"},null,8,ce)],64))),128)),g("circle",{cx:"0",cy:"0",r:d*.1,fill:r.primaryStroke},null,8,fe)],8,ue))}}),pe=K(me,[["__scopeId","data-v-89ee69de"]]),I=O([]),B=O([]),ve=y(()=>I.value.join(",")),he=y(()=>B.value.join(",")),U=[{value:"'N'",label:"N"},{value:"'S'",label:"S"},{value:"'E'",label:"E"},{value:"'O'",label:"O"},{value:"'NE'",label:"NE"},{value:"'NO'",label:"NO"},{value:"'SE'",label:"SE"},{value:"'SO'",label:"SO"},{value:"'NNE'",label:"NNE"},{value:"'NNO'",label:"NNO"},{value:"'SSE'",label:"SSE"},{value:"'SSO'",label:"SSO"},{value:"'ENE'",label:"ENE"},{value:"'ESE'",label:"ESE"},{value:"'OSO'",label:"OSO"},{value:"'ONO'",label:"ONO"}];document.addEventListener("DOMContentLoaded",()=>{const l=document.getElementById("vue-ajout-falaise");if(!l){console.warn("[velogrimpe] #vue-ajout-falaise mount point not found");return}let c=[],u=!1,i=null;try{c=JSON.parse(l.dataset.falaises||"[]"),u=l.dataset.admin==="true",i=l.dataset.presetFalaiseId?parseInt(l.dataset.presetFalaiseId,10):null}catch(d){console.error("[velogrimpe] Failed to parse ajout-falaise data:",d)}const f=d=>d.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,255),m=d=>{typeof window.fetchAndPrefillData=="function"&&window.fetchAndPrefillData(d)};L({setup(){const d=O(""),E=O(i!==null);i&&(E.value=!0);const N=(r,S)=>{var s,V,_;const p=document.getElementById("confirmButton"),t=document.getElementById("falaiseExistsAlert"),e=document.getElementById("falaiseEditInfo"),n=document.getElementById("falaise_id"),h=document.getElementById("falaise_nomformate"),v=document.getElementById("falaise_latlng"),o=document.getElementById("linkSelectedFalaise");if(p&&(p.textContent="Ajouter la falaise"),!S){t&&t.classList.add("hidden"),e&&e.classList.add("hidden");return}const a=c.find(C=>C.nom.toLowerCase()===S.toLowerCase());a?((s=document.getElementById("falaise_img1_preview"))==null||s.classList.add("hidden"),(V=document.getElementById("falaise_img2_preview"))==null||V.classList.add("hidden"),(_=document.getElementById("falaise_img3_preview"))==null||_.classList.add("hidden"),v&&a.latlng&&(v.value=a.latlng),h&&a.nomformate&&(h.value=a.nomformate),v==null||v.dispatchEvent(new Event("input")),a.status==="verrouillée"?(t&&t.classList.remove("hidden"),e&&e.classList.add("hidden"),o&&(o.href=`/falaise.php?falaise_id=${a.id}`),u&&m(a.id)):(t&&t.classList.add("hidden"),e&&e.classList.remove("hidden"),n&&(n.value=String(a.id)),m(a.id))):(t&&t.classList.add("hidden"),e&&e.classList.add("hidden"),h&&(h.value=f(S)),n&&(n.value=""))};return Z(d,r=>{if(!c.find(p=>p.nom.toLowerCase()===r.toLowerCase())){const p=document.getElementById("falaise_nomformate");p&&(p.value=f(r))}}),()=>$(ee,{modelValue:d.value,"onUpdate:modelValue":r=>{d.value=r},items:c.map(r=>({...r,nom:r.nom})),acceptNewValue:!0,disabled:E.value,onSelect:N})}}).mount(l),console.log("[velogrimpe] Vue ajout-falaise autocomplete mounted"),ge()});function F(l){return l?l.split(",").map(c=>c.trim()).filter(c=>c.length>0):[]}function ge(){const l=document.getElementById("vue-exposhort1");if(l){const i=l.dataset.value||"";I.value=F(i),L({setup(){return()=>$(q,{modelValue:I.value,"onUpdate:modelValue":m=>{I.value=m},options:U,name:"falaise_exposhort1",required:!0,placeholder:"Sélectionner..."})}}).mount(l)}const c=document.getElementById("vue-exposhort2");if(c){const i=c.dataset.value||"";B.value=F(i),L({setup(){return()=>$(q,{modelValue:B.value,"onUpdate:modelValue":m=>{B.value=m},options:U,name:"falaise_exposhort2",required:!1,placeholder:"Sélectionner..."})}}).mount(c)}const u=document.getElementById("vue-rose-preview");u&&L({setup(){return()=>$(pe,{expo1:ve.value,expo2:he.value,size:80})}}).mount(u),window.setExpo1Value=i=>{I.value=F(i)},window.setExpo2Value=i=>{B.value=F(i)}}
