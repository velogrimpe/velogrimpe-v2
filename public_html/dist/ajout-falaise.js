import{d as P,r as O,f as y,x as Q,O as T,c as x,o as b,a as g,w as j,m as G,F as $,b as D,j as H,n as A,t as z,g as W,P as X,k as F,l as Y,N as L}from"./chunks/runtime-dom.esm-bundler-CvJMXt7Z.js";import{_ as Z}from"./chunks/FormAutocomplete.vue_vue_type_script_setup_true_lang-t-v9WMV7.js";import{_ as K}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";import"./chunks/Autocomplete.vue_vue_type_script_setup_true_lang-B-Tf6Nrb.js";const ee=["name","value","required"],te={class:"flex items-center gap-1 flex-grow min-w-0 overflow-hidden"},ae=["onClick"],ne=["placeholder","disabled"],le=["disabled"],se={class:"absolute top-full left-0 w-full z-50 bg-white border border-base-300 rounded-lg shadow-lg mt-1 flex flex-wrap p-1"},oe=["onClick"],ie=P({__name:"MultiSelect",props:{modelValue:{},options:{},name:{},placeholder:{default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(l,{emit:d}){const u=l,i=d,m=O(""),p=O(!1),w=O(null),r=O(null),E=y(()=>new Set(u.modelValue)),N=y(()=>u.options.filter(s=>E.value.has(s.value))),c=y(()=>{const s=u.options.filter(o=>!E.value.has(o.value));if(!m.value)return s;const n=m.value.toUpperCase();return s.filter(o=>o.label.toUpperCase().includes(n))}),S=y(()=>u.modelValue.join(","));function a(s){var o;const n=[...u.modelValue,s.value];i("update:modelValue",n),i("change",n),m.value="",(o=r.value)==null||o.focus()}function t(s){if(u.disabled)return;const n=u.modelValue.filter(o=>o!==s.value);i("update:modelValue",n),i("change",n)}function e(s){var n;s.stopPropagation(),i("update:modelValue",[]),i("change",[]),m.value="",(n=r.value)==null||n.focus()}function f(){var s;u.disabled||(p.value=!0,(s=r.value)==null||s.focus())}function v(s){(s.key==="Enter"||s.key==="NumpadEnter")&&m.value&&c.value.length>0&&a(c.value[0])}function h(s){w.value&&!w.value.contains(s.target)&&(p.value=!1)}return Q(()=>{document.addEventListener("click",h)}),T(()=>{document.removeEventListener("click",h)}),(s,n)=>(b(),x("div",{ref_key:"containerRef",ref:w,class:"multi-select-container relative"},[g("input",{type:"hidden",name:l.name,value:S.value,required:l.required&&l.modelValue.length===0},null,8,ee),g("div",{class:A(["input input-primary input-sm flex items-center h-auto min-h-8 cursor-text py-1 pr-1",{"input-disabled":l.disabled}]),onClick:f},[g("div",te,[(b(!0),x($,null,D(N.value,o=>(b(),x("span",{key:o.value,class:A(["badge badge-info text-white badge-sm cursor-pointer select-none",{"cursor-not-allowed":l.disabled}]),onClick:H(V=>t(o),["stop"])},z(o.label),11,ae))),128)),j(g("input",{ref_key:"searchInputRef",ref:r,"onUpdate:modelValue":n[0]||(n[0]=o=>m.value=o),type:"text",class:"flex-grow min-w-[8px] border-0 outline-none bg-transparent text-sm h-5",placeholder:N.value.length===0?l.placeholder:"",disabled:l.disabled,onKeyup:v,onFocus:n[1]||(n[1]=o=>p.value=!0)},null,40,ne),[[W,m.value]])]),N.value.length>0?(b(),x("button",{key:0,type:"button",class:"btn btn-xs btn-ghost p-0 h-5 min-h-0 shrink-0 ml-1",title:"Clear Selection",disabled:l.disabled,onClick:e},[...n[2]||(n[2]=[g("svg",{class:"w-4 h-4 fill-current"},[g("use",{href:"/symbols/icons.svg#ri-close-line"})],-1)])],8,le)):G("",!0)],2),j(g("div",se,[(b(!0),x($,null,D(c.value,o=>(b(),x("div",{key:o.value,class:"badge badge-info text-white m-1 px-2 py-1 cursor-pointer select-none hover:badge-primary",onClick:V=>a(o)},z(o.label),9,oe))),128))],512),[[X,p.value&&c.value.length>0]])],512))}}),q=K(ie,[["__scopeId","data-v-925e1fba"]]),ue=["width","height"],re=["points"],de=["points"],ce=["r"],_=120,R=16,me=P({__name:"RoseDesVents",props:{expo1:{},expo2:{default:""},size:{default:60}},setup(l){const d=l,u=["E","ESE","SE","SSE","S","SSO","SO","OSO","O","ONO","NO","NNO","N","NNE","NE","ENE"];function i(a){if(!a)return new Set;const t=a.replace(/'/g,"").split(",").map(e=>e.trim()).filter(Boolean);return new Set(t)}function m(a){const t=[{name:"ESE",needs:["E","SE"]},{name:"SSE",needs:["SE","S"]},{name:"SSO",needs:["S","SO"]},{name:"OSO",needs:["SO","O"]},{name:"ONO",needs:["O","NO"]},{name:"NNO",needs:["NO","N"]},{name:"NNE",needs:["N","NE"]},{name:"ENE",needs:["NE","E"]}],e=new Set;for(const f of t)f.needs.every(v=>a.has(v))&&e.add(f.name);return e}const p=y(()=>{const a=i(d.expo1),t=m(a);return new Set([...a,...t])}),w=y(()=>{const a=i(d.expo2),t=m(a);return new Set([...a,...t])}),r=_*.6,E=2*Math.PI/R,N=y(()=>{const a=[];for(let t=0;t<R;t++){const e=t*E,f=e+E/2,v=e+E,h=t%4===0?_:t%2===0?_*.9:_*.75,s=(t+1)%4===0?_:(t+1)%2===0?_*.9:_*.75,n=Math.cos(e)*h,o=Math.sin(e)*h,V=Math.cos(f)*r,k=Math.sin(f)*r,M=Math.cos(v)*s,J=Math.sin(v)*s;a.push({direction:u[t],path1:`0,0 ${n.toFixed(2)},${o.toFixed(2)} ${V.toFixed(2)},${k.toFixed(2)}`,path2:`0,0 ${M.toFixed(2)},${J.toFixed(2)} ${V.toFixed(2)},${k.toFixed(2)}`})}return a});function c(a,t){const e=t?u[(u.indexOf(a)+1)%16]:a;return p.value.has(e)?"fill-primary":w.value.has(e)?"fill-primary/50":"fill-base-200"}function S(a,t){const e=t?u[(u.indexOf(a)+1)%16]:a;return p.value.has(e)?"stroke-primary":w.value.has(e)?"stroke-primary/50":"stroke-base-300"}return(a,t)=>(b(),x("svg",{width:l.size,height:l.size,viewBox:"-150 -150 300 300",class:"rose-des-vents"},[(b(!0),x($,null,D(N.value,e=>(b(),x($,{key:e.direction},[g("polygon",{points:e.path1,class:A([c(e.direction,!1),S(e.direction,!1)]),"stroke-width":"1"},null,10,re),g("polygon",{points:e.path2,class:A([c(e.direction,!0),S(e.direction,!0)]),"stroke-width":"1"},null,10,de)],64))),128)),g("circle",{cx:"0",cy:"0",r:r*.1,class:"fill-primary"},null,8,ce)],8,ue))}}),pe=K(me,[["__scopeId","data-v-e4ebec6a"]]),I=O([]),B=O([]),fe=y(()=>I.value.join(",")),ve=y(()=>B.value.join(",")),U=[{value:"'N'",label:"N"},{value:"'S'",label:"S"},{value:"'E'",label:"E"},{value:"'O'",label:"O"},{value:"'NE'",label:"NE"},{value:"'NO'",label:"NO"},{value:"'SE'",label:"SE"},{value:"'SO'",label:"SO"},{value:"'NNE'",label:"NNE"},{value:"'NNO'",label:"NNO"},{value:"'SSE'",label:"SSE"},{value:"'SSO'",label:"SSO"},{value:"'ENE'",label:"ENE"},{value:"'ESE'",label:"ESE"},{value:"'OSO'",label:"OSO"},{value:"'ONO'",label:"ONO"}];document.addEventListener("DOMContentLoaded",()=>{const l=document.getElementById("vue-ajout-falaise");if(!l){console.warn("[velogrimpe] #vue-ajout-falaise mount point not found");return}let d=[],u=!1,i=null;try{d=JSON.parse(l.dataset.falaises||"[]"),u=l.dataset.admin==="true",i=l.dataset.presetFalaiseId?parseInt(l.dataset.presetFalaiseId,10):null}catch(r){console.error("[velogrimpe] Failed to parse ajout-falaise data:",r)}const m=r=>r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,255),p=r=>{typeof window.fetchAndPrefillData=="function"&&window.fetchAndPrefillData(r)};F({setup(){const r=O(""),E=O(i!==null);i&&(E.value=!0);const N=(c,S)=>{var o,V,k;const a=document.getElementById("confirmButton"),t=document.getElementById("falaiseExistsAlert"),e=document.getElementById("falaiseEditInfo"),f=document.getElementById("falaise_id"),v=document.getElementById("falaise_nomformate"),h=document.getElementById("falaise_latlng"),s=document.getElementById("linkSelectedFalaise");if(a&&(a.textContent="Ajouter la falaise"),!S){t&&t.classList.add("hidden"),e&&e.classList.add("hidden");return}const n=d.find(M=>M.nom.toLowerCase()===S.toLowerCase());n?((o=document.getElementById("falaise_img1_preview"))==null||o.classList.add("hidden"),(V=document.getElementById("falaise_img2_preview"))==null||V.classList.add("hidden"),(k=document.getElementById("falaise_img3_preview"))==null||k.classList.add("hidden"),h&&n.latlng&&(h.value=n.latlng),v&&n.nomformate&&(v.value=n.nomformate),h==null||h.dispatchEvent(new Event("input")),n.status==="verrouillée"?(t&&t.classList.remove("hidden"),e&&e.classList.add("hidden"),s&&(s.href=`/falaise.php?falaise_id=${n.id}`),u&&p(n.id)):(t&&t.classList.add("hidden"),e&&e.classList.remove("hidden"),f&&(f.value=String(n.id)),p(n.id))):(t&&t.classList.add("hidden"),e&&e.classList.add("hidden"),v&&(v.value=m(S)),f&&(f.value=""))};return Y(r,c=>{if(!d.find(a=>a.nom.toLowerCase()===c.toLowerCase())){const a=document.getElementById("falaise_nomformate");a&&(a.value=m(c))}}),()=>L(Z,{modelValue:r.value,"onUpdate:modelValue":c=>{r.value=c},items:d.map(c=>({...c,nom:c.nom})),acceptNewValue:!0,disabled:E.value,onSelect:N})}}).mount(l),console.log("[velogrimpe] Vue ajout-falaise autocomplete mounted"),he()});function C(l){return l?l.split(",").map(d=>d.trim()).filter(d=>d.length>0):[]}function he(){const l=document.getElementById("vue-exposhort1");if(l){const i=l.dataset.value||"";I.value=C(i),F({setup(){return()=>L(q,{modelValue:I.value,"onUpdate:modelValue":p=>{I.value=p},options:U,name:"falaise_exposhort1",required:!0,placeholder:"Sélectionner..."})}}).mount(l)}const d=document.getElementById("vue-exposhort2");if(d){const i=d.dataset.value||"";B.value=C(i),F({setup(){return()=>L(q,{modelValue:B.value,"onUpdate:modelValue":p=>{B.value=p},options:U,name:"falaise_exposhort2",required:!1,placeholder:"Sélectionner..."})}}).mount(d)}const u=document.getElementById("vue-rose-preview");u&&F({setup(){return()=>L(pe,{expo1:fe.value,expo2:ve.value,size:80})}}).mount(u),window.setExpo1Value=i=>{I.value=C(i)},window.setExpo2Value=i=>{B.value=C(i)}}
