import{d as $,r as v,f as y,N as z,O as P,c as w,o as x,a as g,w as A,m as K,F,b as j,j as J,n as D,t as q,g as Q,P as T,k as C,l as G,M as L}from"./chunks/runtime-dom.esm-bundler-Cpy2cnzk.js";import{_ as H}from"./chunks/FormAutocomplete.vue_vue_type_script_setup_true_lang-1__GtXz4.js";import{_ as W}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";import{R as X}from"./chunks/RoseDesVents-Bu9qEODZ.js";import"./chunks/Autocomplete.vue_vue_type_script_setup_true_lang-B97YQDHO.js";const Y=["name","value","required"],Z={class:"flex items-center gap-1 grow min-w-0 overflow-hidden"},ee=["onClick"],te=["placeholder","disabled"],ae=["disabled"],le={class:"absolute top-full left-0 w-full z-50 bg-white border border-base-300 rounded-lg shadow-lg mt-1 flex flex-wrap p-1"},ne=["onClick"],oe=$({__name:"MultiSelect",props:{modelValue:{},options:{},name:{},placeholder:{default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(t,{emit:s}){const i=t,n=s,u=v(""),r=v(!1),O=v(null),o=v(null),I=y(()=>new Set(i.modelValue)),d=y(()=>i.options.filter(e=>I.value.has(e.value))),f=y(()=>{const e=i.options.filter(a=>!I.value.has(a.value));if(!u.value)return e;const l=u.value.toUpperCase();return e.filter(a=>a.label.toUpperCase().includes(l))}),p=y(()=>i.modelValue.join(","));function c(e){var a;const l=[...i.modelValue,e.value];n("update:modelValue",l),n("change",l),u.value="",(a=o.value)==null||a.focus()}function m(e){if(i.disabled)return;const l=i.modelValue.filter(a=>a!==e.value);n("update:modelValue",l),n("change",l)}function E(e){var l;e.stopPropagation(),n("update:modelValue",[]),n("change",[]),u.value="",(l=o.value)==null||l.focus()}function b(){var e;i.disabled||(r.value=!0,(e=o.value)==null||e.focus())}function h(e){(e.key==="Enter"||e.key==="NumpadEnter")&&u.value&&f.value.length>0&&c(f.value[0])}function S(e){O.value&&!O.value.contains(e.target)&&(r.value=!1)}return z(()=>{document.addEventListener("click",S)}),P(()=>{document.removeEventListener("click",S)}),(e,l)=>(x(),w("div",{ref_key:"containerRef",ref:O,class:"multi-select-container relative"},[g("input",{type:"hidden",name:t.name,value:p.value,required:t.required&&t.modelValue.length===0},null,8,Y),g("div",{class:D(["input input-primary input-sm flex items-center h-auto min-h-8 cursor-text py-1 pr-1",{"input-disabled":t.disabled}]),onClick:b},[g("div",Z,[(x(!0),w(F,null,j(d.value,a=>(x(),w("span",{key:a.value,class:D(["badge badge-info text-white badge-sm cursor-pointer select-none",{"cursor-not-allowed":t.disabled}]),onClick:J(k=>m(a),["stop"])},q(a.label),11,ee))),128)),A(g("input",{ref_key:"searchInputRef",ref:o,"onUpdate:modelValue":l[0]||(l[0]=a=>u.value=a),type:"text",class:"grow min-w-2 border-0 outline-hidden bg-transparent text-sm h-5",placeholder:d.value.length===0?t.placeholder:"",disabled:t.disabled,onKeyup:h,onFocus:l[1]||(l[1]=a=>r.value=!0)},null,40,te),[[Q,u.value]])]),d.value.length>0?(x(),w("button",{key:0,type:"button",class:"btn btn-xs btn-ghost p-0 h-5 min-h-0 shrink-0 ml-1",title:"Clear Selection",disabled:t.disabled,onClick:E},[...l[2]||(l[2]=[g("svg",{class:"w-4 h-4 fill-none stroke-current"},[g("use",{href:"#close"})],-1)])],8,ae)):K("",!0)],2),A(g("div",le,[(x(!0),w(F,null,j(f.value,a=>(x(),w("div",{key:a.value,class:"badge badge-info text-white m-1 px-2 py-1 cursor-pointer select-none hover:badge-primary",onClick:k=>c(a)},q(a.label),9,ne))),128))],512),[[T,r.value&&f.value.length>0]])],512))}}),M=W(oe,[["__scopeId","data-v-a735ca79"]]),V=v([]),N=v([]),_=v(""),se=y(()=>V.value.join(",")),ie=y(()=>N.value.join(",")),U=[{value:"'N'",label:"N"},{value:"'S'",label:"S"},{value:"'E'",label:"E"},{value:"'O'",label:"O"},{value:"'NE'",label:"NE"},{value:"'NO'",label:"NO"},{value:"'SE'",label:"SE"},{value:"'SO'",label:"SO"},{value:"'NNE'",label:"NNE"},{value:"'NNO'",label:"NNO"},{value:"'SSE'",label:"SSE"},{value:"'SSO'",label:"SSO"},{value:"'ENE'",label:"ENE"},{value:"'ESE'",label:"ESE"},{value:"'OSO'",label:"OSO"},{value:"'ONO'",label:"ONO"}];document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("vue-ajout-falaise");if(!t){console.warn("[velogrimpe] #vue-ajout-falaise mount point not found");return}let s=[],i=!1,n=null;try{s=JSON.parse(t.dataset.falaises||"[]"),i=t.dataset.admin==="true",n=t.dataset.presetFalaiseId?parseInt(t.dataset.presetFalaiseId,10):null}catch(o){console.error("[velogrimpe] Failed to parse ajout-falaise data:",o)}const u=o=>o.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,255),r=o=>{typeof window.fetchAndPrefillData=="function"&&window.fetchAndPrefillData(o)};C({setup(){const o=v(n!==null);n&&(o.value=!0);const I=(d,f)=>{var l,a,k;const p=document.getElementById("confirmButton"),c=document.getElementById("falaiseExistsAlert"),m=document.getElementById("falaiseEditInfo"),E=document.getElementById("falaise_id"),b=document.getElementById("falaise_nomformate"),h=document.getElementById("falaise_latlng"),S=document.getElementById("linkSelectedFalaise");if(p&&(p.textContent="Ajouter la falaise"),!f){c&&c.classList.add("hidden"),m&&m.classList.add("hidden");return}const e=s.find(R=>R.nom.toLowerCase()===f.toLowerCase());e?((l=document.getElementById("falaise_img1_preview"))==null||l.classList.add("hidden"),(a=document.getElementById("falaise_img2_preview"))==null||a.classList.add("hidden"),(k=document.getElementById("falaise_img3_preview"))==null||k.classList.add("hidden"),h&&e.latlng&&(h.value=e.latlng),b&&e.nomformate&&(b.value=e.nomformate),h==null||h.dispatchEvent(new Event("input")),e.status==="verrouillée"?(c&&c.classList.remove("hidden"),m&&m.classList.add("hidden"),S&&(S.href=`/falaise.php?falaise_id=${e.id}`),i&&r(e.id)):(c&&c.classList.add("hidden"),m&&m.classList.remove("hidden"),E&&(E.value=String(e.id)),r(e.id))):(c&&c.classList.add("hidden"),m&&m.classList.add("hidden"),b&&(b.value=u(f)),E&&(E.value=""))};return G(_,d=>{if(!s.find(p=>p.nom.toLowerCase()===d.toLowerCase())){const p=document.getElementById("falaise_nomformate");p&&(p.value=u(d))}}),()=>L(H,{modelValue:_.value,"onUpdate:modelValue":d=>{_.value=d},items:s.map(d=>({...d,nom:d.nom})),acceptNewValue:!0,disabled:o.value,onSelect:I,name:"falaise_nom",required:!0})}}).mount(t),console.log("[velogrimpe] Vue ajout-falaise autocomplete mounted"),window.setFalaiseNom=o=>{_.value=o},ue()});function B(t){return t?t.split(",").map(s=>s.trim()).filter(s=>s.length>0):[]}function ue(){const t=document.getElementById("vue-exposhort1");if(t){const n=t.dataset.value||"";V.value=B(n),C({setup(){return()=>L(M,{modelValue:V.value,"onUpdate:modelValue":r=>{V.value=r},options:U,name:"falaise_exposhort1",required:!0,placeholder:"Sélectionner..."})}}).mount(t)}const s=document.getElementById("vue-exposhort2");if(s){const n=s.dataset.value||"";N.value=B(n),C({setup(){return()=>L(M,{modelValue:N.value,"onUpdate:modelValue":r=>{N.value=r},options:U,name:"falaise_exposhort2",required:!1,placeholder:"Sélectionner..."})}}).mount(s)}const i=document.getElementById("vue-rose-preview");i&&C({setup(){return()=>L(X,{expo1:se.value,expo2:ie.value,size:100})}}).mount(i),window.setExpo1Value=n=>{V.value=B(n)},window.setExpo2Value=n=>{N.value=B(n)}}
