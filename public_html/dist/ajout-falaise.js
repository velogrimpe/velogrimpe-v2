import{d as P,r as h,f as k,x as z,O as R,c as b,o as E,a as v,w as _,F as A,b as F,j as D,n as M,t as j,g as K,m as q,P as T,k as B,l as J,N as L}from"./chunks/runtime-dom.esm-bundler-CvJMXt7Z.js";import{_ as Q}from"./chunks/FormAutocomplete.vue_vue_type_script_setup_true_lang-t-v9WMV7.js";import{_ as G}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";import"./chunks/Autocomplete.vue_vue_type_script_setup_true_lang-B-Tf6Nrb.js";const H=["name","value","required"],W={class:"flex flex-wrap items-center gap-1 flex-grow"},X=["onClick"],Y=["placeholder","disabled"],Z={class:"flex items-center gap-1"},ee=["disabled"],le=["disabled"],te={class:"absolute top-full left-0 w-full z-50 bg-white border border-base-300 rounded-lg shadow-lg mt-1 flex flex-wrap p-1"},ae=["onClick"],ne=P({__name:"MultiSelect",props:{modelValue:{},options:{},name:{},placeholder:{default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},showSelectAll:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(e,{emit:u}){const o=e,n=u,r=h(""),s=h(!1),O=h(null),i=h(null),S=k(()=>new Set(o.modelValue)),V=k(()=>o.options.filter(l=>S.value.has(l.value))),d=k(()=>{const l=o.options.filter(a=>!S.value.has(a.value));if(!r.value)return l;const t=r.value.toUpperCase();return l.filter(a=>a.label.toUpperCase().includes(t))}),x=k(()=>o.modelValue.join(","));function f(l){var a;const t=[...o.modelValue,l.value];n("update:modelValue",t),n("change",t),r.value="",(a=i.value)==null||a.focus()}function m(l){if(o.disabled)return;const t=o.modelValue.filter(a=>a!==l.value);n("update:modelValue",t),n("change",t)}function p(){var t;const l=o.options.map(a=>a.value);n("update:modelValue",l),n("change",l),s.value=!1,r.value="",(t=i.value)==null||t.focus()}function w(l){var t;l.stopPropagation(),n("update:modelValue",[]),n("change",[]),r.value="",(t=i.value)==null||t.focus()}function y(){var l;o.disabled||(s.value=!0,(l=i.value)==null||l.focus())}function g(l){(l.key==="Enter"||l.key==="NumpadEnter")&&r.value&&d.value.length>0&&f(d.value[0])}function N(l){O.value&&!O.value.contains(l.target)&&(s.value=!1)}function c(){s.value=!1}return z(()=>{document.addEventListener("click",N)}),R(()=>{document.removeEventListener("click",N)}),(l,t)=>(E(),b("div",{ref_key:"containerRef",ref:O,class:"multi-select-container relative",onMouseleave:c},[v("input",{type:"hidden",name:e.name,value:x.value,required:e.required&&e.modelValue.length===0},null,8,H),v("div",{class:M(["input input-primary input-sm flex items-center flex-wrap gap-1 h-auto min-h-8 cursor-text",{"input-disabled":e.disabled}]),onClick:y},[v("div",W,[(E(!0),b(A,null,F(V.value,a=>(E(),b("span",{key:a.value,class:M(["badge badge-info text-white badge-sm px-2 py-1 cursor-pointer select-none",{"cursor-not-allowed":e.disabled}]),onClick:D(C=>m(a),["stop"])},j(a.label),11,X))),128)),_(v("input",{ref_key:"searchInputRef",ref:i,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),type:"text",class:"flex-grow min-w-[40px] border-0 outline-none bg-transparent text-sm",placeholder:V.value.length===0?e.placeholder:"",disabled:e.disabled,onKeyup:g,onFocus:t[1]||(t[1]=a=>s.value=!0)},null,40,Y),[[K,r.value]])]),v("div",Z,[e.showSelectAll&&d.value.length>0?(E(),b("button",{key:0,type:"button",class:"btn btn-xs btn-ghost p-1",title:"Tout",disabled:e.disabled,onClick:D(p,["stop"])},[...t[2]||(t[2]=[v("svg",{class:"w-4 h-4 fill-current"},[v("use",{href:"/symbols/icons.svg#ri-check-double-line"})],-1)])],8,ee)):q("",!0),V.value.length>0?(E(),b("button",{key:1,type:"button",class:"btn btn-xs btn-ghost p-1",title:"Clear Selection",disabled:e.disabled,onClick:w},[...t[3]||(t[3]=[v("svg",{class:"w-4 h-4 fill-current"},[v("use",{href:"/symbols/icons.svg#ri-close-line"})],-1)])],8,le)):q("",!0)])],2),_(v("div",te,[(E(!0),b(A,null,F(d.value,a=>(E(),b("div",{key:a.value,class:"badge badge-info text-white m-1 px-2 py-1 cursor-pointer select-none hover:badge-primary",onClick:C=>f(a)},j(a.label),9,ae))),128))],512),[[T,s.value&&d.value.length>0]])],544))}}),U=G(ne,[["__scopeId","data-v-397bfb7d"]]),$=[{value:"'N'",label:"N"},{value:"'S'",label:"S"},{value:"'E'",label:"E"},{value:"'O'",label:"O"},{value:"'NE'",label:"NE"},{value:"'NO'",label:"NO"},{value:"'SE'",label:"SE"},{value:"'SO'",label:"SO"},{value:"'NNE'",label:"NNE"},{value:"'NNO'",label:"NNO"},{value:"'SSE'",label:"SSE"},{value:"'SSO'",label:"SSO"},{value:"'ENE'",label:"ENE"},{value:"'ESE'",label:"ESE"},{value:"'OSO'",label:"OSO"},{value:"'ONO'",label:"ONO"}];document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("vue-ajout-falaise");if(!e){console.warn("[velogrimpe] #vue-ajout-falaise mount point not found");return}let u=[],o=!1,n=null;try{u=JSON.parse(e.dataset.falaises||"[]"),o=e.dataset.admin==="true",n=e.dataset.presetFalaiseId?parseInt(e.dataset.presetFalaiseId,10):null}catch(i){console.error("[velogrimpe] Failed to parse ajout-falaise data:",i)}const r=i=>i.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,255),s=i=>{typeof window.fetchAndPrefillData=="function"&&window.fetchAndPrefillData(i)};B({setup(){const i=h(""),S=h(n!==null);n&&(S.value=!0);const V=(d,x)=>{var l,t,a;const f=document.getElementById("confirmButton"),m=document.getElementById("falaiseExistsAlert"),p=document.getElementById("falaiseEditInfo"),w=document.getElementById("falaise_id"),y=document.getElementById("falaise_nomformate"),g=document.getElementById("falaise_latlng"),N=document.getElementById("linkSelectedFalaise");if(f&&(f.textContent="Ajouter la falaise"),!x){m&&m.classList.add("hidden"),p&&p.classList.add("hidden");return}const c=u.find(C=>C.nom.toLowerCase()===x.toLowerCase());c?((l=document.getElementById("falaise_img1_preview"))==null||l.classList.add("hidden"),(t=document.getElementById("falaise_img2_preview"))==null||t.classList.add("hidden"),(a=document.getElementById("falaise_img3_preview"))==null||a.classList.add("hidden"),g&&c.latlng&&(g.value=c.latlng),y&&c.nomformate&&(y.value=c.nomformate),g==null||g.dispatchEvent(new Event("input")),c.status==="verrouillée"?(m&&m.classList.remove("hidden"),p&&p.classList.add("hidden"),N&&(N.href=`/falaise.php?falaise_id=${c.id}`),o&&s(c.id)):(m&&m.classList.add("hidden"),p&&p.classList.remove("hidden"),w&&(w.value=String(c.id)),s(c.id))):(m&&m.classList.add("hidden"),p&&p.classList.add("hidden"),y&&(y.value=r(x)),w&&(w.value=""))};return J(i,d=>{if(!u.find(f=>f.nom.toLowerCase()===d.toLowerCase())){const f=document.getElementById("falaise_nomformate");f&&(f.value=r(d))}}),()=>L(Q,{modelValue:i.value,"onUpdate:modelValue":d=>{i.value=d},items:u.map(d=>({...d,nom:d.nom})),acceptNewValue:!0,disabled:S.value,onSelect:V})}}).mount(e),console.log("[velogrimpe] Vue ajout-falaise autocomplete mounted"),se()});function I(e){return e?e.split(",").map(u=>u.trim()).filter(u=>u.length>0):[]}function se(){const e=document.getElementById("vue-exposhort1");if(e){const o=e.dataset.value||"",n=h(I(o));B({setup(){return()=>L(U,{modelValue:n.value,"onUpdate:modelValue":s=>{n.value=s},options:$,name:"falaise_exposhort1",required:!0,placeholder:"Sélectionner..."})}}).mount(e),window.setExpo1Value=s=>{n.value=I(s)}}const u=document.getElementById("vue-exposhort2");if(u){const o=u.dataset.value||"",n=h(I(o));B({setup(){return()=>L(U,{modelValue:n.value,"onUpdate:modelValue":s=>{n.value=s},options:$,name:"falaise_exposhort2",required:!1,placeholder:"Sélectionner..."})}}).mount(u),window.setExpo2Value=s=>{n.value=I(s)}}}
