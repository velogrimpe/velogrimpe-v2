import{d as $,r as v,f as y,N as z,O as P,c as x,o as w,a as h,w as A,m as K,F,b as j,j as J,n as D,t as q,g as Q,P as T,k as C,l as G,M as _}from"./chunks/runtime-dom.esm-bundler-Cpy2cnzk.js";import{_ as H}from"./chunks/FormAutocomplete.vue_vue_type_script_setup_true_lang-DCBUFmHv.js";import{_ as W}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";import{R as X}from"./chunks/RoseDesVents-CxJ9c6AM.js";import"./chunks/Autocomplete.vue_vue_type_script_setup_true_lang-yCm09Fm9.js";const Y=["name","value","required"],Z={class:"flex items-center gap-1 flex-grow min-w-0 overflow-hidden"},ee=["onClick"],te=["placeholder","disabled"],le=["disabled"],ae={class:"absolute top-full left-0 w-full z-50 bg-white border border-base-300 rounded-lg shadow-lg mt-1 flex flex-wrap p-1"},ne=["onClick"],oe=$({__name:"MultiSelect",props:{modelValue:{},options:{},name:{},placeholder:{default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(t,{emit:o}){const s=t,n=o,d=v(""),r=v(!1),I=v(null),i=v(null),S=y(()=>new Set(s.modelValue)),V=y(()=>s.options.filter(l=>S.value.has(l.value))),u=y(()=>{const l=s.options.filter(a=>!S.value.has(a.value));if(!d.value)return l;const e=d.value.toUpperCase();return l.filter(a=>a.label.toUpperCase().includes(e))}),g=y(()=>s.modelValue.join(","));function c(l){var a;const e=[...s.modelValue,l.value];n("update:modelValue",e),n("change",e),d.value="",(a=i.value)==null||a.focus()}function m(l){if(s.disabled)return;const e=s.modelValue.filter(a=>a!==l.value);n("update:modelValue",e),n("change",e)}function f(l){var e;l.stopPropagation(),n("update:modelValue",[]),n("change",[]),d.value="",(e=i.value)==null||e.focus()}function b(){var l;s.disabled||(r.value=!0,(l=i.value)==null||l.focus())}function E(l){(l.key==="Enter"||l.key==="NumpadEnter")&&d.value&&u.value.length>0&&c(u.value[0])}function p(l){I.value&&!I.value.contains(l.target)&&(r.value=!1)}return z(()=>{document.addEventListener("click",p)}),P(()=>{document.removeEventListener("click",p)}),(l,e)=>(w(),x("div",{ref_key:"containerRef",ref:I,class:"multi-select-container relative"},[h("input",{type:"hidden",name:t.name,value:g.value,required:t.required&&t.modelValue.length===0},null,8,Y),h("div",{class:D(["input input-primary input-sm flex items-center h-auto min-h-8 cursor-text py-1 pr-1",{"input-disabled":t.disabled}]),onClick:b},[h("div",Z,[(w(!0),x(F,null,j(V.value,a=>(w(),x("span",{key:a.value,class:D(["badge badge-info text-white badge-sm cursor-pointer select-none",{"cursor-not-allowed":t.disabled}]),onClick:J(k=>m(a),["stop"])},q(a.label),11,ee))),128)),A(h("input",{ref_key:"searchInputRef",ref:i,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),type:"text",class:"flex-grow min-w-[8px] border-0 outline-none bg-transparent text-sm h-5",placeholder:V.value.length===0?t.placeholder:"",disabled:t.disabled,onKeyup:E,onFocus:e[1]||(e[1]=a=>r.value=!0)},null,40,te),[[Q,d.value]])]),V.value.length>0?(w(),x("button",{key:0,type:"button",class:"btn btn-xs btn-ghost p-0 h-5 min-h-0 shrink-0 ml-1",title:"Clear Selection",disabled:t.disabled,onClick:f},[...e[2]||(e[2]=[h("svg",{class:"w-4 h-4 fill-current"},[h("use",{href:"/symbols/icons.svg#ri-close-line"})],-1)])],8,le)):K("",!0)],2),A(h("div",ae,[(w(!0),x(F,null,j(u.value,a=>(w(),x("div",{key:a.value,class:"badge badge-info text-white m-1 px-2 py-1 cursor-pointer select-none hover:badge-primary",onClick:k=>c(a)},q(a.label),9,ne))),128))],512),[[T,r.value&&u.value.length>0]])],512))}}),M=W(oe,[["__scopeId","data-v-925e1fba"]]),N=v([]),O=v([]),se=y(()=>N.value.join(",")),ie=y(()=>O.value.join(",")),U=[{value:"'N'",label:"N"},{value:"'S'",label:"S"},{value:"'E'",label:"E"},{value:"'O'",label:"O"},{value:"'NE'",label:"NE"},{value:"'NO'",label:"NO"},{value:"'SE'",label:"SE"},{value:"'SO'",label:"SO"},{value:"'NNE'",label:"NNE"},{value:"'NNO'",label:"NNO"},{value:"'SSE'",label:"SSE"},{value:"'SSO'",label:"SSO"},{value:"'ENE'",label:"ENE"},{value:"'ESE'",label:"ESE"},{value:"'OSO'",label:"OSO"},{value:"'ONO'",label:"ONO"}];document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("vue-ajout-falaise");if(!t){console.warn("[velogrimpe] #vue-ajout-falaise mount point not found");return}let o=[],s=!1,n=null;try{o=JSON.parse(t.dataset.falaises||"[]"),s=t.dataset.admin==="true",n=t.dataset.presetFalaiseId?parseInt(t.dataset.presetFalaiseId,10):null}catch(i){console.error("[velogrimpe] Failed to parse ajout-falaise data:",i)}const d=i=>i.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,255),r=i=>{typeof window.fetchAndPrefillData=="function"&&window.fetchAndPrefillData(i)};C({setup(){const i=v(""),S=v(n!==null);n&&(S.value=!0);const V=(u,g)=>{var a,k,L;const c=document.getElementById("confirmButton"),m=document.getElementById("falaiseExistsAlert"),f=document.getElementById("falaiseEditInfo"),b=document.getElementById("falaise_id"),E=document.getElementById("falaise_nomformate"),p=document.getElementById("falaise_latlng"),l=document.getElementById("linkSelectedFalaise");if(c&&(c.textContent="Ajouter la falaise"),!g){m&&m.classList.add("hidden"),f&&f.classList.add("hidden");return}const e=o.find(R=>R.nom.toLowerCase()===g.toLowerCase());e?((a=document.getElementById("falaise_img1_preview"))==null||a.classList.add("hidden"),(k=document.getElementById("falaise_img2_preview"))==null||k.classList.add("hidden"),(L=document.getElementById("falaise_img3_preview"))==null||L.classList.add("hidden"),p&&e.latlng&&(p.value=e.latlng),E&&e.nomformate&&(E.value=e.nomformate),p==null||p.dispatchEvent(new Event("input")),e.status==="verrouillée"?(m&&m.classList.remove("hidden"),f&&f.classList.add("hidden"),l&&(l.href=`/falaise.php?falaise_id=${e.id}`),s&&r(e.id)):(m&&m.classList.add("hidden"),f&&f.classList.remove("hidden"),b&&(b.value=String(e.id)),r(e.id))):(m&&m.classList.add("hidden"),f&&f.classList.add("hidden"),E&&(E.value=d(g)),b&&(b.value=""))};return G(i,u=>{if(!o.find(c=>c.nom.toLowerCase()===u.toLowerCase())){const c=document.getElementById("falaise_nomformate");c&&(c.value=d(u))}}),()=>_(H,{modelValue:i.value,"onUpdate:modelValue":u=>{i.value=u},items:o.map(u=>({...u,nom:u.nom})),acceptNewValue:!0,disabled:S.value,onSelect:V})}}).mount(t),console.log("[velogrimpe] Vue ajout-falaise autocomplete mounted"),ue()});function B(t){return t?t.split(",").map(o=>o.trim()).filter(o=>o.length>0):[]}function ue(){const t=document.getElementById("vue-exposhort1");if(t){const n=t.dataset.value||"";N.value=B(n),C({setup(){return()=>_(M,{modelValue:N.value,"onUpdate:modelValue":r=>{N.value=r},options:U,name:"falaise_exposhort1",required:!0,placeholder:"Sélectionner..."})}}).mount(t)}const o=document.getElementById("vue-exposhort2");if(o){const n=o.dataset.value||"";O.value=B(n),C({setup(){return()=>_(M,{modelValue:O.value,"onUpdate:modelValue":r=>{O.value=r},options:U,name:"falaise_exposhort2",required:!1,placeholder:"Sélectionner..."})}}).mount(o)}const s=document.getElementById("vue-rose-preview");s&&C({setup(){return()=>_(X,{expo1:se.value,expo2:ie.value,size:100})}}).mount(s),window.setExpo1Value=n=>{N.value=B(n)},window.setExpo2Value=n=>{O.value=B(n)}}
