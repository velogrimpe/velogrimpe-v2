import{d as R,r as h,f as y,y as $,z as P,A as K,c as w,o as x,a as N,w as F,m as J,F as D,b as j,j as Q,n as q,t as U,g as T,i as G,B as H,k as L,l as W,x as S}from"./chunks/runtime-dom.esm-bundler-CFjh9Irh.js";import{_ as X}from"./chunks/FormAutocomplete.vue_vue_type_script_setup_true_lang-BdKR2Brq.js";import{_ as Y}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";import{R as Z}from"./chunks/RoseDesVents-MRPjGiLk.js";import"./chunks/Autocomplete.vue_vue_type_script_setup_true_lang-DITvEN9E.js";const ee=["name","value","required"],te={class:"flex items-center gap-1 grow min-w-0 overflow-hidden"},ae=["onClick"],le=["placeholder","disabled"],ne=["disabled"],oe={class:"absolute top-full left-0 w-full z-50 bg-white border border-base-300 rounded-lg shadow-lg mt-1 flex flex-wrap p-1"},se=["onClick"],ie=R({__name:"MultiSelect",props:{modelValue:{},options:{},name:{},placeholder:{default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(t,{emit:o}){const s=t,a=o,d=h(""),c=h(!1),_=h(null),l=h(null),k=y(()=>new Set(s.modelValue)),r=y(()=>s.options.filter(e=>k.value.has(e.value))),p=y(()=>{const e=s.options.filter(i=>!k.value.has(i.value));if(!d.value)return e;const n=d.value.toUpperCase();return e.filter(i=>i.label.toUpperCase().includes(n))}),v=y(()=>s.modelValue.join(","));function m(e){var i;const n=[...s.modelValue,e.value];a("update:modelValue",n),a("change",n),d.value="",(i=l.value)==null||i.focus()}function f(e){if(s.disabled)return;const n=s.modelValue.filter(i=>i!==e.value);a("update:modelValue",n),a("change",n)}function b(e){var n;e.stopPropagation(),a("update:modelValue",[]),a("change",[]),d.value="",(n=l.value)==null||n.focus()}function E(){var e;s.disabled||(c.value=!0,(e=l.value)==null||e.focus())}function g(e){(e.key==="Enter"||e.key==="NumpadEnter")&&d.value&&p.value.length>0&&m(p.value[0])}function V(e){_.value&&!_.value.contains(e.target)&&(c.value=!1)}return $(()=>{document.addEventListener("click",V)}),P(()=>{document.removeEventListener("click",V)}),(e,n)=>{const i=K("Icon");return x(),w("div",{ref_key:"containerRef",ref:_,class:"multi-select-container relative"},[N("input",{type:"hidden",name:t.name,value:v.value,required:t.required&&t.modelValue.length===0},null,8,ee),N("div",{class:q(["input input-primary input-sm flex items-center h-auto min-h-8 cursor-text py-1 pr-1",{"input-disabled":t.disabled}]),onClick:E},[N("div",te,[(x(!0),w(D,null,j(r.value,u=>(x(),w("span",{key:u.value,class:q(["badge badge-info text-white badge-sm cursor-pointer select-none",{"cursor-not-allowed":t.disabled}]),onClick:Q(A=>f(u),["stop"])},U(u.label),11,ae))),128)),F(N("input",{ref_key:"searchInputRef",ref:l,"onUpdate:modelValue":n[0]||(n[0]=u=>d.value=u),type:"text",class:"grow min-w-2 border-0 outline-hidden bg-transparent text-sm h-5",placeholder:r.value.length===0?t.placeholder:"",disabled:t.disabled,onKeyup:g,onFocus:n[1]||(n[1]=u=>c.value=!0)},null,40,le),[[T,d.value]])]),r.value.length>0?(x(),w("button",{key:0,type:"button",class:"btn btn-xs btn-ghost p-0 h-5 min-h-0 shrink-0 ml-1",title:"Clear Selection",disabled:t.disabled,onClick:b},[G(i,{name:"close",class:"w-4 h-4"})],8,ne)):J("",!0)],2),F(N("div",oe,[(x(!0),w(D,null,j(p.value,u=>(x(),w("div",{key:u.value,class:"badge badge-info text-white m-1 px-2 py-1 cursor-pointer select-none hover:badge-primary",onClick:A=>m(u)},U(u.label),9,se))),128))],512),[[H,c.value&&p.value.length>0]])],512)}}}),z=Y(ie,[["__scopeId","data-v-b6eb1e8a"]]),ue=()=>({icon:()=>S("svg",{class:"w-4 h-4 fill-none stroke-current shrink-0"},[S("use",{href:"#search"})])}),I=h([]),O=h([]),B=h(""),de=y(()=>I.value.join(",")),re=y(()=>O.value.join(",")),M=[{value:"'N'",label:"N"},{value:"'S'",label:"S"},{value:"'E'",label:"E"},{value:"'O'",label:"O"},{value:"'NE'",label:"NE"},{value:"'NO'",label:"NO"},{value:"'SE'",label:"SE"},{value:"'SO'",label:"SO"},{value:"'NNE'",label:"NNE"},{value:"'NNO'",label:"NNO"},{value:"'SSE'",label:"SSE"},{value:"'SSO'",label:"SSO"},{value:"'ENE'",label:"ENE"},{value:"'ESE'",label:"ESE"},{value:"'OSO'",label:"OSO"},{value:"'ONO'",label:"ONO"}];document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("vue-ajout-falaise");if(!t){console.warn("[velogrimpe] #vue-ajout-falaise mount point not found");return}let o=[],s=!1,a=null;try{o=JSON.parse(t.dataset.falaises||"[]"),s=t.dataset.admin==="true",a=t.dataset.presetFalaiseId?parseInt(t.dataset.presetFalaiseId,10):null}catch(l){console.error("[velogrimpe] Failed to parse ajout-falaise data:",l)}const d=l=>l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,255),c=l=>{typeof window.fetchAndPrefillData=="function"&&window.fetchAndPrefillData(l)};if(L({setup(){const l=h(a!==null);a&&(l.value=!0);const k=(r,p)=>{var n,i,u;const v=document.getElementById("confirmButton"),m=document.getElementById("falaiseExistsAlert"),f=document.getElementById("falaiseEditInfo"),b=document.getElementById("falaise_id"),E=document.getElementById("falaise_nomformate"),g=document.getElementById("falaise_latlng"),V=document.getElementById("linkSelectedFalaise");if(v&&(v.textContent="Ajouter la falaise"),!p){m&&m.classList.add("hidden"),f&&f.classList.add("hidden");return}const e=o.find(A=>A.nom.toLowerCase()===p.toLowerCase());e?((n=document.getElementById("falaise_img1_preview"))==null||n.classList.add("hidden"),(i=document.getElementById("falaise_img2_preview"))==null||i.classList.add("hidden"),(u=document.getElementById("falaise_img3_preview"))==null||u.classList.add("hidden"),g&&e.latlng&&(g.value=e.latlng),E&&e.nomformate&&(E.value=e.nomformate),g==null||g.dispatchEvent(new Event("input")),e.status==="verrouillée"?(m&&m.classList.remove("hidden"),f&&f.classList.add("hidden"),V&&(V.href=`/falaise.php?falaise_id=${e.id}`),s&&c(e.id)):(m&&m.classList.add("hidden"),f&&f.classList.remove("hidden"),b&&(b.value=String(e.id)),c(e.id))):(m&&m.classList.add("hidden"),f&&f.classList.add("hidden"),E&&(E.value=d(p)),b&&(b.value=""))};return W(B,r=>{if(!o.find(v=>v.nom.toLowerCase()===r.toLowerCase())){const v=document.getElementById("falaise_nomformate");v&&(v.value=d(r))}}),()=>S(X,{modelValue:B.value,"onUpdate:modelValue":r=>{B.value=r},items:o.map(r=>({...r,nom:r.nom})),acceptNewValue:!0,disabled:l.value,onSelect:k,name:"falaise_nom",required:!0},ue())}}).mount(t),console.log("[velogrimpe] Vue ajout-falaise autocomplete mounted"),window.setFalaiseNom=l=>{B.value=l},a){const l=window.fetchAndPrefillData;l&&l(a)}ce()});function C(t){return t?t.split(",").map(o=>o.trim()).filter(o=>o.length>0):[]}function ce(){const t=document.getElementById("vue-exposhort1");if(t){const a=t.dataset.value||"";I.value=C(a),L({setup(){return()=>S(z,{modelValue:I.value,"onUpdate:modelValue":c=>{I.value=c},options:M,name:"falaise_exposhort1",required:!0,placeholder:"Sélectionner..."})}}).mount(t)}const o=document.getElementById("vue-exposhort2");if(o){const a=o.dataset.value||"";O.value=C(a),L({setup(){return()=>S(z,{modelValue:O.value,"onUpdate:modelValue":c=>{O.value=c},options:M,name:"falaise_exposhort2",required:!1,placeholder:"Sélectionner..."})}}).mount(o)}const s=document.getElementById("vue-rose-preview");s&&L({setup(){return()=>S(Z,{expo1:de.value,expo2:re.value,size:100})}}).mount(s),window.setExpo1Value=a=>{I.value=C(a)},window.setExpo2Value=a=>{O.value=C(a)}}
