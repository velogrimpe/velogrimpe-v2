import{d as V,r as C,f as T,c as o,o as l,n as y,a as e,j as M,m,t as p,w as v,e as g,g as w,h as $,F as D,b as P,i as U,u as F}from"./runtime-dom.esm-bundler-CFjh9Irh.js";import{u as L}from"./useToast-C5d6NyTe.js";import{_ as j}from"./Icon.vue_vue_type_script_setup_true_lang-CxRcsHEs.js";const O={class:"modal-box w-11/12 max-w-2xl"},E={key:0,class:"alert alert-info mb-4"},N={class:"font-semibold"},q={class:"text-sm"},G={class:"form-control w-full mb-4"},R={key:0,class:"label"},z={class:"label-text-alt text-error"},B={class:"form-control w-full mb-4"},A={key:0,class:"label"},I={class:"label-text-alt text-error"},J={class:"form-control w-full mb-4"},W={class:"flex flex-col gap-2"},H={class:"label cursor-pointer justify-start gap-2"},K={class:"label cursor-pointer justify-start gap-2"},Q={class:"label cursor-pointer justify-start gap-2"},X={class:"label cursor-pointer justify-start gap-2"},Y={key:0,class:"label"},Z={class:"label-text-alt text-error"},ee={key:1,class:"form-control w-full mb-4"},te={key:0,class:"label"},ae={class:"label-text-alt text-error"},se={class:"form-control w-full mb-4"},ne={class:"modal-action"},ie=["disabled"],oe={key:0,class:"loading loading-spinner"},le={key:1},je=V({__name:"ParticipationModal",props:{sortie:{},isOpen:{type:Boolean}},emits:["close","submitted"],setup(s,{emit:b}){const n=s,d=b,{showToast:f}=L(),t=C({participant_nom:"",participant_email:"",participant_telephone:"",preferences_contact:{signal:!1,whatsapp:!1,email:!0,telephone:!1},message:""}),i=C({}),x=C(!1);if(typeof window<"u"&&window.contribStorage){const r=window.contribStorage.getContribInfo();r.nom&&(t.value.participant_nom=r.nom),r.email&&(t.value.participant_email=r.email)}const u=T(()=>{const r=t.value.preferences_contact;return r.signal||r.whatsapp||r.email||r.telephone});function _(){return i.value={},t.value.participant_nom.trim()||(i.value.participant_nom="Votre nom est requis"),t.value.participant_email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value.participant_email)||(i.value.participant_email="Email invalide"):i.value.participant_email="Votre email est requis",u.value||(i.value.preferences_contact="S√©lectionnez au moins un moyen de contact"),t.value.preferences_contact.telephone&&!t.value.participant_telephone.trim()&&(i.value.participant_telephone="Le num√©ro de t√©l√©phone est requis si vous le s√©lectionnez comme moyen de contact"),Object.keys(i.value).length===0}async function k(){if(!(!n.sortie||!_())){x.value=!0;try{typeof window<"u"&&window.contribStorage&&window.contribStorage.saveContribInfo(t.value.participant_nom,t.value.participant_email);const r=new FormData;r.append("sortie_id",n.sortie.sortie_id.toString()),r.append("participant_nom",t.value.participant_nom),r.append("participant_email",t.value.participant_email),t.value.participant_telephone&&r.append("participant_telephone",t.value.participant_telephone),r.append("preferences_contact",JSON.stringify(t.value.preferences_contact)),t.value.message&&r.append("message",t.value.message);const c=await(await fetch("/api/add_participation.php",{method:"POST",body:r})).json();c.success?(f("Votre demande de participation a √©t√© envoy√©e ! L'admin validera votre demande et transf√©rera vos coordonn√©es √† l'organisateur.","success"),d("submitted"),d("close"),S()):f(`Erreur : ${c.error}`,"error")}catch(r){console.error("Error submitting participation:",r),f("Une erreur est survenue lors de l'envoi de votre demande","error")}finally{x.value=!1}}}function S(){t.value.participant_telephone="",t.value.preferences_contact={signal:!1,whatsapp:!1,email:!0,telephone:!1},t.value.message="",i.value={}}function h(){d("close"),S()}return(r,a)=>(l(),o("dialog",{class:y([{"modal modal-open":s.isOpen},"modal"])},[e("div",O,[e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:h}," ‚úï "),a[17]||(a[17]=e("h3",{class:"font-bold text-lg mb-4"}," Je suis int√©ress√©(e) par cette sortie ",-1)),e("form",{onSubmit:M(k,["prevent"])},[s.sortie?(l(),o("div",E,[e("div",null,[e("div",N,p(s.sortie.falaise_principale_nom),1),e("div",q,p(new Date(s.sortie.date_debut).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}))+" - Organis√©e par "+p(s.sortie.organisateur_nom),1)])])):m("",!0),e("div",G,[a[8]||(a[8]=e("label",{class:"label"},[e("span",{class:"label-text"},[g("Votre nom "),e("span",{class:"text-error"},"*")])],-1)),v(e("input",{"onUpdate:modelValue":a[0]||(a[0]=c=>t.value.participant_nom=c),type:"text",placeholder:"Pr√©nom Nom",class:y(["input input-bordered w-full",{"input-error":i.value.participant_nom}]),required:""},null,2),[[w,t.value.participant_nom]]),i.value.participant_nom?(l(),o("label",R,[e("span",z,p(i.value.participant_nom),1)])):m("",!0)]),e("div",B,[a[9]||(a[9]=e("label",{class:"label"},[e("span",{class:"label-text"},[g("Votre email "),e("span",{class:"text-error"},"*")])],-1)),v(e("input",{"onUpdate:modelValue":a[1]||(a[1]=c=>t.value.participant_email=c),type:"email",placeholder:"email@example.com",class:y(["input input-bordered w-full",{"input-error":i.value.participant_email}]),required:""},null,2),[[w,t.value.participant_email]]),i.value.participant_email?(l(),o("label",A,[e("span",I,p(i.value.participant_email),1)])):m("",!0)]),e("div",J,[a[14]||(a[14]=e("label",{class:"label"},[e("span",{class:"label-text"},[g("Moyens de contact pr√©f√©r√©s "),e("span",{class:"text-error"},"*")])],-1)),e("div",W,[e("label",H,[v(e("input",{"onUpdate:modelValue":a[2]||(a[2]=c=>t.value.preferences_contact.signal=c),type:"checkbox",class:"checkbox"},null,512),[[$,t.value.preferences_contact.signal]]),a[10]||(a[10]=e("span",{class:"label-text"},"Signal",-1))]),e("label",K,[v(e("input",{"onUpdate:modelValue":a[3]||(a[3]=c=>t.value.preferences_contact.whatsapp=c),type:"checkbox",class:"checkbox"},null,512),[[$,t.value.preferences_contact.whatsapp]]),a[11]||(a[11]=e("span",{class:"label-text"},"WhatsApp",-1))]),e("label",Q,[v(e("input",{"onUpdate:modelValue":a[4]||(a[4]=c=>t.value.preferences_contact.email=c),type:"checkbox",class:"checkbox"},null,512),[[$,t.value.preferences_contact.email]]),a[12]||(a[12]=e("span",{class:"label-text"},"Email",-1))]),e("label",X,[v(e("input",{"onUpdate:modelValue":a[5]||(a[5]=c=>t.value.preferences_contact.telephone=c),type:"checkbox",class:"checkbox"},null,512),[[$,t.value.preferences_contact.telephone]]),a[13]||(a[13]=e("span",{class:"label-text"},"T√©l√©phone",-1))])]),i.value.preferences_contact?(l(),o("label",Y,[e("span",Z,p(i.value.preferences_contact),1)])):m("",!0)]),t.value.preferences_contact.telephone||t.value.preferences_contact.whatsapp||t.value.preferences_contact.signal?(l(),o("div",ee,[a[15]||(a[15]=e("label",{class:"label"},[e("span",{class:"label-text"},[g("Num√©ro de t√©l√©phone "),e("span",{class:"text-error"},"*")])],-1)),v(e("input",{"onUpdate:modelValue":a[6]||(a[6]=c=>t.value.participant_telephone=c),type:"tel",placeholder:"06 12 34 56 78",class:y(["input input-bordered w-full",{"input-error":i.value.participant_telephone}])},null,2),[[w,t.value.participant_telephone]]),i.value.participant_telephone?(l(),o("label",te,[e("span",ae,p(i.value.participant_telephone),1)])):m("",!0)])):m("",!0),e("div",se,[a[16]||(a[16]=e("label",{class:"label"},[e("span",{class:"label-text"},"Message √† l'organisateur (optionnel)")],-1)),v(e("textarea",{"onUpdate:modelValue":a[7]||(a[7]=c=>t.value.message=c),class:"textarea textarea-bordered h-24"},null,512),[[w,t.value.message]])]),e("div",ne,[e("button",{type:"button",class:"btn",onClick:h}," Annuler "),e("button",{type:"submit",class:"btn btn-primary",disabled:x.value},[x.value?(l(),o("span",oe)):(l(),o("span",le,"Envoyer ma demande"))],8,ie)])],32)]),e("form",{method:"dialog",class:"modal-backdrop"},[e("button",{onClick:h},"close")])],2))}}),re={class:"flex flex-col items-start mb-4"},ce={class:"text-3xl md:text-2xl font-bold mb-2 md:mb-0"},pe=["href"],de={class:"mb-4"},ue={class:"text-lg"},me={class:"mb-4"},be={class:"text-lg"},fe={key:0,class:"mb-4"},ve={class:"flex flex-wrap gap-2 mt-1"},_e=["href"],xe={key:1,class:"mb-4"},he={class:"text-lg"},ye={class:"mb-4"},ge={class:"prose prose-sm max-w-none whitespace-pre-wrap"},ke={key:2,class:"mb-4"},we=["href"],$e={class:"mb-6"},Ce={class:"text-sm text-base-content/70"},Se={class:"mt-6"},De={key:1,class:"alert alert-info"},Ve={class:"mt-6 text-sm text-base-content/60"},Le={class:"mt-4 text-center"},Oe=V({__name:"SortieDetailsContent",props:{sortie:{},dateDisplay:{},onGroupLinkClick:{type:Function},onParticipationClick:{type:Function},onCopyLink:{type:Function}},setup(s){return(b,n)=>(l(),o(D,null,[n[10]||(n[10]=e("a",{class:"text-primary font-bold sortie-breadcrumb",href:"/sorties.php"},"‚Üê Retour √† la liste des sorties",-1)),e("div",re,[e("h1",ce," Sortie v√©logrimpe √† "+p(s.sortie.falaise_principale_nom),1),s.sortie.falaise_principale_id?(l(),o("a",{key:0,href:`/falaise.php?falaise_id=${s.sortie.falaise_principale_id}`,class:"link link-primary text-sm",target:"_blank"}," Voir la fiche falaise ",8,pe)):m("",!0)]),e("div",de,[n[3]||(n[3]=e("div",{class:"text-sm text-base-content/70"},"Date",-1)),e("div",ue,p(s.dateDisplay),1)]),e("div",me,[n[4]||(n[4]=e("div",{class:"text-sm text-base-content/70"},"Ville de d√©part",-1)),e("div",be,p(s.sortie.ville_depart),1)]),s.sortie.falaises_alternatives&&s.sortie.falaises_alternatives.length>0?(l(),o("div",fe,[n[5]||(n[5]=e("div",{class:"text-sm text-base-content/70"},"Falaises alternatives",-1)),e("div",ve,[(l(!0),o(D,null,P(s.sortie.falaises_alternatives,(d,f)=>(l(),o("span",{key:f,class:"badge badge-outline"},[g(p(d.nom)+" ",1),d.id?(l(),o("a",{key:0,href:`/falaise.php?falaise_id=${d.id}`,class:"ml-1 link link-primary"},[U(j,{name:"external-link"})],8,_e)):m("",!0)]))),128))])])):m("",!0),s.sortie.velo_nom?(l(),o("div",xe,[n[6]||(n[6]=e("div",{class:"text-sm text-base-content/70"},"Itin√©raire v√©lo pr√©vu",-1)),e("div",he,p(s.sortie.velo_nom),1)])):m("",!0),e("div",ye,[n[7]||(n[7]=e("div",{class:"text-sm text-base-content/70 mb-2"},"Description",-1)),e("div",ge,p(s.sortie.description),1)]),s.sortie.lien_groupe?(l(),o("div",ke,[n[8]||(n[8]=e("div",{class:"text-sm text-base-content/70 mb-2"},"Groupe de discussion",-1)),e("a",{href:s.sortie.lien_groupe,target:"_blank",rel:"noopener noreferrer",class:"link link-primary",onClick:n[0]||(n[0]=(...d)=>s.onGroupLinkClick&&s.onGroupLinkClick(...d))}," Rejoindre le groupe ‚Üí ",8,we)])):m("",!0),e("div",$e,[e("div",Ce,p(s.sortie.nb_interesses)+" personne"+p(s.sortie.nb_interesses>1?"s":"")+" int√©ress√©e"+p(s.sortie.nb_interesses>1?"s":""),1)]),e("div",Se,[s.sortie.is_past?(l(),o("div",De,[...n[9]||(n[9]=[e("span",null,"Cette sortie est pass√©e",-1)])])):(l(),o("button",{key:0,class:"btn btn-primary w-full",onClick:n[1]||(n[1]=(...d)=>s.onParticipationClick&&s.onParticipationClick(...d))}," Je suis int√©ress√©(e) "))]),e("div",Ve," Sortie propos√©e par "+p(s.sortie.organisateur_nom),1),e("div",Le,[e("button",{class:"btn btn-sm btn-outline",onClick:n[2]||(n[2]=(...d)=>s.onCopyLink&&s.onCopyLink(...d))}," üìã Copier le lien de la sortie ")])],64))}});function Ee(s){const b=C(!1),{showToast:n}=L(),d=T(()=>{const u=s();if(!u)return"";const k=new Date(u.date_debut).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"});if(u.date_fin&&u.date_fin!==u.date_debut){const h=new Date(u.date_fin).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"});return`Du ${k} au ${h}`}return k});function f(){b.value=!0}function t(){b.value=!1}function i(){var u;navigator.clipboard.writeText(window.location.origin+`/sortie.php?sortie_id=${(u=s())==null?void 0:u.sortie_id}`),n("Lien copi√© !","success")}async function x(){const u=s();if(u)try{const _=new FormData;_.append("sortie_id",u.sortie_id.toString()),await fetch("/api/increment_interest.php",{method:"POST",body:_})}catch(_){console.error("Error incrementing interest:",_)}}return{isParticipationModalOpen:b,dateDisplay:d,openParticipationModal:f,closeParticipationModal:t,copyLink:i,handleGroupLinkClick:x}}const Fe={class:"toast toast-end z-[9999]"},Te=["onClick"],Ne=V({__name:"ToastContainer",setup(s){const{toasts:b,removeToast:n}=L();return(d,f)=>(l(),o("div",Fe,[(l(!0),o(D,null,P(F(b),t=>(l(),o("div",{key:t.id,class:y(["alert shadow-lg",{"alert-success":t.type==="success","alert-error":t.type==="error","alert-info":t.type==="info"}])},[e("span",null,p(t.message),1),e("button",{class:"btn btn-sm btn-ghost btn-circle",onClick:i=>F(n)(t.id)}," ‚úï ",8,Te)],2))),128))]))}});export{Oe as _,je as a,Ne as b,Ee as u};
