import{d as U,r as E,y as H,z as K,f as m,c as o,o as i,a as e,n as u,u as n,i as x,F as f,b as g,t as w,e as N,m as M,k as Q}from"./chunks/runtime-dom.esm-bundler-DMen96Nq.js";import{c as X}from"./chunks/pinia-CZ5zk4qe.js";import{u as Y}from"./chunks/filters-CmDp-o8g.js";import{_ as y}from"./chunks/Icon.vue_vue_type_script_setup_true_lang-C9j0lfjA.js";import{_ as Z}from"./chunks/SearchAutocomplete.vue_vue_type_script_setup_true_lang-Dz_hQzl_.js";import{_ as ee}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";import"./chunks/Autocomplete.vue_vue_type_script_setup_true_lang-XJhyqp0n.js";const te={class:"leaflet-filters-control flex flex-col max-w-[80vw]"},se={class:"flex items-center gap-1 justify-end max-w-full"},le={class:"flex flex-nowrap gap-1 overflow-x-auto snap-x noscrollbar"},ne={class:"dropdown dropdown-end w-fit shrink-0 snap-end"},oe={class:"dropdown-content menu bg-base-200 rounded-box z-[1001] m-1 w-56 p-2 shadow-lg",tabindex:"1"},ie={class:"flex flex-col gap-2"},ae=["value"],re=["value"],de={class:"dropdown dropdown-end w-fit shrink-0 snap-end"},ue={class:"dropdown-content menu gap-1 bg-base-200 rounded-box z-[1001] m-1 w-64 p-2 shadow-lg",tabindex:"1"},pe={class:"flex flex-col gap-2"},be={class:"flex flex-col gap-3"},ce={class:"flex flex-col gap-1"},me=["checked","onChange"],fe={class:"label-text"},ve={class:"label cursor-pointer gap-2 p-0 pr-1 w-full justify-start"},xe=["value"],ge=["value"],we={class:"grid grid-cols-[auto_auto] gap-x-2 gap-y-1 w-full"},he={class:"label hover:bg-base-300 rounded-lg cursor-pointer gap-2 p-0 pr-1 w-full justify-start"},ye=["checked","onChange"],ke={class:"label-text"},_e={class:"dropdown dropdown-end w-fit shrink-0 snap-end"},Ve={class:"dropdown-content menu bg-base-200 rounded-box z-[1001] m-1 w-40 p-2 shadow-lg",tabindex:"1"},Ce={class:"flex flex-row gap-1 items-center"},Me={class:"max-w-96 flex flex-col gap-1 w-full"},Te=["checked","onChange"],Fe={class:"label-text"},Se={class:"text-xs text-slate-400"},Ee={class:"dropdown w-fit dropdown-end shrink-0 snap-end"},Ne=["title"],Oe={key:0,class:"dropdown-content menu bg-base-200 rounded-box z-[1001] m-1 w-64 p-2 shadow-lg",tabindex:"1"},$e={class:"flex flex-row gap-2 items-center"},Ie=["value"],Pe={class:"flex flex-row items-center gap-1 mt-2"},Ae={class:"flex flex-row gap-2 items-center"},ze={class:"label cursor-pointer gap-1"},je=["checked"],De={class:"label cursor-pointer gap-1"},qe=["checked"],Be={class:"form-control cursor-pointer"},Le={class:"label gap-2 p-0 justify-start"},Re=["checked"],Ge={class:"dropdown w-fit dropdown-end shrink-0 snap-end"},Je={class:"dropdown-content menu bg-base-200 rounded-box z-[1001] m-1 w-64 p-2 shadow-lg",tabindex:"1"},We={class:"flex flex-row gap-3 items-center"},Ue={class:"flex flex-col gap-1"},He={class:"flex flex-row gap-2 flex-wrap items-center"},Ke=["value"],Qe={class:"flex flex-row gap-2 items-center"},Xe=["value"],Ye={class:"flex flex-row gap-2 items-center"},Ze=["value"],et={class:"flex flex-row gap-2 items-center mt-2"},tt={class:"flex flex-row gap-2 items-center hover:bg-base-300 rounded-lg cursor-pointer p-0 pr-1"},st=["checked"],lt={class:"dropdown w-fit dropdown-end shrink-0 snap-end"},nt={class:"dropdown-content menu bg-base-200 rounded-box z-[1001] m-1 w-56 p-2 shadow-lg",tabindex:"1"},ot={class:"flex flex-row gap-2 items-center"},it=["value"],at={class:"dropdown w-fit dropdown-end shrink-0 snap-end"},rt=["title"],dt={key:0,class:"dropdown-content menu bg-base-200 rounded-box z-[1001] m-1 p-2 shadow-lg",tabindex:"1"},ut={class:"flex flex-col gap-2 items-end"},pt={class:"flex flex-row gap-1 items-center"},bt=["value"],ct={class:"flex flex-row gap-1 items-center"},mt=["value"],ft=["disabled"],vt={class:"flex items-center gap-1 justify-end mt-2.5"},xt={key:1,class:"flex items-center gap-1 bg-base-100 rounded-lg shadow-md p-1"},gt={class:"flex-1 min-w-48"},wt=U({__name:"CarteMapFilters",props:{falaises:{},gares:{},villes:{}},setup(p){const b=p,s=Y();function v(d){const t=d.target;if(!t.matches('[role="button"][tabindex="0"]'))return;const l=t.closest(".dropdown");if(!l)return;const a=l.querySelector(".dropdown-content");if(!a)return;const C=t.getBoundingClientRect(),W=window.innerWidth<768;a.style.position="fixed",a.style.top=`${C.bottom}px`,a.style.left="auto",W?a.style.right="50px":a.style.right=`${window.innerWidth-C.right}px`}const h=E(window.innerWidth>=768);H(()=>{document.addEventListener("focusin",v)}),K(()=>{document.removeEventListener("focusin",v)});function _(){h.value=!0}function $(){h.value=!1}const V=E(!1);function I(){V.value=!0}function T(){V.value=!1}function P(d){T()}const A=[{id:"N",label:"Nord",hint:"(NO, N, NE)"},{id:"E",label:"Est",hint:"(NE, E, SE)"},{id:"S",label:"Sud",hint:"(SE, S, SO)"},{id:"O",label:"Ouest",hint:"(SO, O, NO)"}],z=[[{id:"40",label:"4 et -"}],[{id:"50",label:"5-"},{id:"59",label:"5+"}],[{id:"60",label:"6-"},{id:"69",label:"6+"}],[{id:"70",label:"7-"},{id:"79",label:"7+"}],[{id:"80",label:"8 et +"}]],j=[{id:"couenne",label:"Couenne"},{id:"grandeVoie",label:"Grandes voies"},{id:"bloc",label:"Bloc"},{id:"psychobloc",label:"Psychobloc"}],D=[{value:0,label:"Pas de minimum"},{value:20,label:"Plus de 20"},{value:50,label:"Plus de 50"},{value:100,label:"Plus de 100"},{value:200,label:"Plus de 200"}],q=m(()=>s.filters.exposition.length>0),B=m(()=>s.filters.cotations.length>0||s.filters.typeVoies.couenne||s.filters.typeVoies.grandeVoie||s.filters.typeVoies.bloc||s.filters.typeVoies.psychobloc||s.filters.nbVoiesMin>0),F=m(()=>s.filters.train.tempsMax!==null||s.filters.train.correspMax!==null||s.filters.train.terOnly),L=m(()=>s.filters.velo.tempsMax!==null||s.filters.velo.distMax!==null||s.filters.velo.denivMax!==null||s.filters.velo.apiedPossible),R=m(()=>s.filters.approche.tempsMax!==null),S=m(()=>s.filters.total.tempsTV!==null||s.filters.total.tempsTVA!==null),r=m(()=>s.filters.villeId!==null);function G(d){return s.filters.exposition.includes(d)}function J(d){return s.filters.cotations.includes(d)}function c(d){const t=parseInt(d,10);return isNaN(t)?null:t}return(d,t)=>(i(),o("div",te,[e("div",se,[h.value?(i(),o(f,{key:1},[e("div",le,[e("div",ne,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm text-nowrap focus:pointer-events-none shadow-md border-0",r.value?"btn-primary":"bg-base-100"])}," Ville ðŸ™ï¸ ",2),e("div",oe,[e("div",ie,[t[16]||(t[16]=e("div",{class:"font-bold"},"Ville de dÃ©part",-1)),e("select",{class:"select select-sm border-base-300 focus:outline-base-300 w-full",value:n(s).filters.villeId??"",onChange:t[0]||(t[0]=l=>n(s).setVilleId(l.target.value||null))},[t[15]||(t[15]=e("option",{value:""},"Toutes les villes",-1)),(i(!0),o(f,null,g(b.villes,l=>(i(),o("option",{key:l.ville_id,value:l.ville_id},w(l.ville_nom),9,re))),128))],40,ae)])])]),e("div",de,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm text-nowrap focus:pointer-events-none shadow-md border-0",B.value?"btn-primary":"bg-base-100"])}," Voies ðŸ§—â€â™€ï¸ ",2),e("div",ue,[e("div",pe,[e("div",be,[t[18]||(t[18]=e("div",null,[e("span",{class:"font-bold"},"Cotations"),N(" (ex: 5+ ET 6+) ")],-1)),e("div",ce,[(i(),o(f,null,g(z,l=>e("div",{key:l[0].id,class:"flex flex-row gap-4"},[(i(!0),o(f,null,g(l,a=>(i(),o("label",{key:a.id,class:u(["label hover:bg-base-300 rounded-lg cursor-pointer gap-2 p-0 pr-1",{"w-16 justify-start":l.length>1}])},[e("input",{type:"checkbox",checked:J(a.id),class:"checkbox checkbox-primary checkbox-sm",onChange:C=>n(s).toggleCotation(a.id)},null,40,me),e("span",fe,w(a.label),1)],2))),128))])),64)),t[17]||(t[17]=e("span",{class:"italic text-base-300 text-sm"},"(5- = de 5a Ã  5b, 5+ = de 5b+ Ã  5c+)",-1))])])]),t[19]||(t[19]=e("div",{class:"font-bold"},"Nombre de voies",-1)),e("div",null,[e("label",ve,[e("select",{class:"select border-base-300 select-sm focus:outline-base-300",value:n(s).filters.nbVoiesMin,onChange:t[1]||(t[1]=l=>n(s).setNbVoiesMin(Number(l.target.value)))},[(i(),o(f,null,g(D,l=>e("option",{key:l.value,value:l.value},w(l.label),9,ge)),64))],40,xe)])]),t[20]||(t[20]=e("div",{class:"font-bold"},"Types de voies",-1)),e("div",we,[(i(),o(f,null,g(j,l=>e("div",{key:l.id,class:"flex flex-row gap-2 items-center w-full"},[e("label",he,[e("input",{type:"checkbox",checked:n(s).filters.typeVoies[l.id],class:"checkbox checkbox-primary checkbox-sm",onChange:a=>n(s).setTypeVoie(l.id,!n(s).filters.typeVoies[l.id])},null,40,ye),e("span",ke,w(l.label),1)])])),64))])])]),e("div",_e,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm text-nowrap focus:pointer-events-none shadow-md border-0",q.value?"btn-primary":"bg-base-100"])}," Exposition ðŸ”… ",2),e("div",Ve,[e("div",Ce,[e("div",Me,[(i(),o(f,null,g(A,l=>e("label",{key:l.id,class:"label hover:bg-base-300 rounded-lg cursor-pointer gap-2 p-0 pr-1 w-full justify-start"},[e("input",{type:"checkbox",checked:G(l.id),class:"checkbox checkbox-primary checkbox-sm",onChange:a=>n(s).toggleExposition(l.id)},null,40,Te),e("span",Fe,[N(w(l.label)+" ",1),e("span",Se,w(l.hint),1)])])),64))])])])]),e("div",Ee,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm text-nowrap focus:pointer-events-none shadow-md border-0",{"btn-primary":F.value,"bg-base-100":!F.value&&r.value,"bg-base-200 opacity-50":!r.value}]),title:r.value?"Filtrer par train":"SÃ©lectionnez une ville pour filtrer par train"}," Train ðŸšž ",10,Ne),r.value?(i(),o("div",Oe,[e("label",$e,[t[21]||(t[21]=e("div",{class:"font-bold"},"DurÃ©e",-1)),t[22]||(t[22]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.train.tempsMax??"",onInput:t[2]||(t[2]=l=>n(s).setTrainTempsMax(c(l.target.value)))},null,40,Ie),t[23]||(t[23]=e("div",null,"minutes",-1))]),e("div",Pe,[t[26]||(t[26]=e("div",null,"Nb. Corresp. Max",-1)),e("div",Ae,[e("label",ze,[e("input",{type:"radio",name:"nbCorrespMax",value:"0",class:"radio radio-primary radio-xs",checked:n(s).filters.train.correspMax===0,onChange:t[3]||(t[3]=l=>n(s).setTrainCorrespMax(0))},null,40,je),t[24]||(t[24]=e("span",{class:"label-text"},"0",-1))]),e("label",De,[e("input",{type:"radio",name:"nbCorrespMax",value:"1",class:"radio radio-primary radio-xs",checked:n(s).filters.train.correspMax===1,onChange:t[4]||(t[4]=l=>n(s).setTrainCorrespMax(1))},null,40,qe),t[25]||(t[25]=e("span",{class:"label-text"},"â‰¤1",-1))]),n(s).filters.train.correspMax!==null?(i(),o("button",{key:0,type:"button",class:"btn btn-ghost btn-xs p-0",title:"RÃ©initialiser",onClick:t[5]||(t[5]=l=>n(s).setTrainCorrespMax(null))}," âœ• ")):M("",!0)])]),t[29]||(t[29]=e("div",{class:"divider my-1"},null,-1)),e("label",Be,[e("div",Le,[t[27]||(t[27]=e("span",{class:"label-text text-sm"},"TGV OK",-1)),e("input",{type:"checkbox",class:"toggle toggle-primary toggle-sm",checked:n(s).filters.train.terOnly,onChange:t[6]||(t[6]=l=>n(s).setTrainTerOnly(!n(s).filters.train.terOnly))},null,40,Re),t[28]||(t[28]=e("span",{class:"label-text text-sm"},"TER uniquement",-1))])])])):M("",!0)]),e("div",Ge,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm text-nowrap focus:pointer-events-none shadow-md border-0",L.value?"btn-primary":"bg-base-100"])}," VÃ©lo ðŸš² ",2),e("div",Je,[e("div",We,[t[36]||(t[36]=e("div",null,"Trajet vÃ©lo",-1)),e("div",Ue,[e("label",He,[t[30]||(t[30]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.velo.tempsMax??"",onInput:t[7]||(t[7]=l=>n(s).setVeloTempsMax(c(l.target.value)))},null,40,Ke),t[31]||(t[31]=e("div",null,"minutes",-1))]),e("label",Qe,[t[32]||(t[32]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.velo.distMax??"",onInput:t[8]||(t[8]=l=>n(s).setVeloDistMax(c(l.target.value)))},null,40,Xe),t[33]||(t[33]=e("div",null,"km",-1))]),e("label",Ye,[t[34]||(t[34]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.velo.denivMax??"",onInput:t[9]||(t[9]=l=>n(s).setVeloDenivMax(c(l.target.value)))},null,40,Ze),t[35]||(t[35]=e("div",null,"D+",-1))])])]),e("div",et,[t[38]||(t[38]=e("div",{class:"bg-base-100 rounded-full w-6 h-6 border-2 border-base-300 flex items-center justify-center text-xs text-slate-600 font-bold"}," OU ",-1)),e("label",tt,[e("input",{type:"checkbox",checked:n(s).filters.velo.apiedPossible,class:"checkbox border-base-300 bg-base-100",onChange:t[10]||(t[10]=l=>n(s).setVeloApiedPossible(!n(s).filters.velo.apiedPossible))},null,40,st),t[37]||(t[37]=e("div",null,"Accessible Ã  pied",-1))])])])]),e("div",lt,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm text-nowrap focus:pointer-events-none shadow-md border-0",R.value?"btn-primary":"bg-base-100"])}," Marche ðŸ¥¾ ",2),e("div",nt,[e("label",ot,[t[39]||(t[39]=e("div",{class:"font-bold"},"Approche",-1)),t[40]||(t[40]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.approche.tempsMax??"",onInput:t[11]||(t[11]=l=>n(s).setApprocheTempsMax(c(l.target.value)))},null,40,it),t[41]||(t[41]=e("div",null,"minutes",-1))])])]),e("div",at,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm text-nowrap focus:pointer-events-none shadow-md border-0",{"btn-primary":S.value,"bg-base-100":!S.value&&r.value,"bg-base-200 opacity-50":!r.value}]),title:r.value?"Filtrer par temps total":"SÃ©lectionnez une ville pour filtrer par temps total"}," Total â±ï¸ ",10,rt),r.value?(i(),o("div",dt,[e("div",ut,[e("label",pt,[t[42]||(t[42]=e("div",null,"Train+VÃ©lo",-1)),t[43]||(t[43]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.total.tempsTV??"",onInput:t[12]||(t[12]=l=>n(s).setTotalTempsTV(c(l.target.value)))},null,40,bt),t[44]||(t[44]=e("div",null,"minutes",-1))]),e("label",ct,[t[45]||(t[45]=e("div",null,"Train+VÃ©lo+Approche",-1)),t[46]||(t[46]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.total.tempsTVA??"",onInput:t[13]||(t[13]=l=>n(s).setTotalTempsTVA(c(l.target.value)))},null,40,mt),t[47]||(t[47]=e("div",null,"minutes",-1))])])])):M("",!0)])]),e("button",{type:"button",class:"btn btn-sm btn-square bg-base-100 shadow-md border-0 shrink-0",disabled:!n(s).hasActiveFilters,title:"RÃ©initialiser les filtres",onClick:t[14]||(t[14]=l=>n(s).resetFilters())},[x(y,{name:"refresh",class:"w-3 h-3 stroke-2"})],8,ft),e("button",{type:"button",class:"btn btn-sm btn-square bg-base-100 shadow-md border-0 shrink-0",title:"Fermer les filtres",onClick:$},[x(y,{name:"close",class:"w-4 h-4 stroke-2"})])],64)):(i(),o("button",{key:0,type:"button",class:u(["btn btn-sm btn-square shadow-md border-0",n(s).hasActiveFilters?"btn-primary":"bg-base-100"]),title:"Filtrer les falaises",onClick:_},[x(y,{name:"filter",class:"w-4 h-4 stroke-2"})],2))]),e("div",vt,[V.value?(i(),o("div",xt,[e("div",gt,[x(Z,{falaises:b.falaises,gares:b.gares,onSelect:P},null,8,["falaises","gares"])]),e("button",{type:"button",class:"btn btn-sm btn-square btn-ghost",title:"Fermer la recherche",onClick:T},[x(y,{name:"close",class:"w-4 h-4 stroke-2"})])])):(i(),o("button",{key:0,type:"button",class:"btn btn-sm btn-square bg-base-100 shadow-md border-0",title:"Rechercher une falaise ou une gare",onClick:I},[x(y,{name:"search",class:"w-4 h-4 stroke-2"})]))])]))}}),ht=ee(wt,[["__scopeId","data-v-4160db6c"]]);function O(){const p=document.getElementById("vue-map-filters");if(!p){console.warn("[velogrimpe] #vue-map-filters mount point not found");return}let b=[],s=[],v=[];try{b=JSON.parse(p.dataset.falaises||"[]"),s=JSON.parse(p.dataset.gares||"[]"),v=JSON.parse(p.dataset.villes||"[]"),console.log(`[velogrimpe] Parsed data: ${b.length} falaises, ${s.length} gares, ${v.length} villes`)}catch(_){console.error("[velogrimpe] Failed to parse data from PHP:",_)}const k=Q(ht,{falaises:b,gares:s,villes:v}),h=X();k.use(h),k.mount(p),console.log("[velogrimpe] Vue map filters app mounted")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",O):setTimeout(O,0);
