import{d as H,r as T,y as K,z as Q,f as m,c as o,o as i,a as e,n as u,u as n,i as x,F as f,b as g,t as w,e as O,m as M,I as X,k as Y}from"./chunks/runtime-dom.esm-bundler-CFjh9Irh.js";import{c as Z}from"./chunks/pinia-CsLZD9ME.js";import{u as ee}from"./chunks/filters-DNgSUJ0W.js";import{_ as y}from"./chunks/Icon.vue_vue_type_script_setup_true_lang-CxRcsHEs.js";import{_ as te}from"./chunks/SearchAutocomplete.vue_vue_type_script_setup_true_lang-XmEcy5yX.js";import{_ as se}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";import"./chunks/Autocomplete.vue_vue_type_script_setup_true_lang-DITvEN9E.js";const le={class:"leaflet-filters-control flex flex-col max-w-[80vw]"},ne={class:"flex items-center gap-1 justify-end max-w-full"},oe={class:"flex flex-nowrap gap-1 overflow-x-auto snap-x noscrollbar"},ie={class:"dropdown dropdown-end w-fit shrink-0 snap-end"},ae={class:"dropdown-content menu bg-base-200 rounded-box z-[1001] m-1 w-56 p-2 shadow-lg",tabindex:"1"},re={class:"flex flex-col gap-2"},de=["value"],ue=["value"],pe={class:"dropdown dropdown-end w-fit shrink-0 snap-end"},be={class:"dropdown-content menu gap-1 bg-base-200 rounded-box z-[1001] m-1 w-64 p-2 shadow-lg",tabindex:"1"},ce={class:"flex flex-col gap-2"},me={class:"flex flex-col gap-3"},fe={class:"flex flex-col gap-1"},ve=["checked","onChange"],xe={class:"label-text"},ge={class:"label cursor-pointer gap-2 p-0 pr-1 w-full justify-start"},we=["value"],he=["value"],ye={class:"grid grid-cols-[auto_auto] gap-x-2 gap-y-1 w-full"},ke={class:"label hover:bg-base-300 rounded-lg cursor-pointer gap-2 p-0 pr-1 w-full justify-start"},_e=["checked","onChange"],Ve={class:"label-text"},Ce={class:"dropdown dropdown-end w-fit shrink-0 snap-end"},Te={class:"dropdown-content menu bg-base-200 rounded-box z-[1001] m-1 w-40 p-2 shadow-lg",tabindex:"1"},Me={class:"flex flex-row gap-1 items-center"},Fe={class:"max-w-96 flex flex-col gap-1 w-full"},Se=["checked","onChange"],Ee={class:"label-text"},Ne={class:"text-xs text-slate-400"},Oe={class:"dropdown w-fit dropdown-end shrink-0 snap-end"},$e=["title"],Ie={key:0,class:"dropdown-content menu bg-base-200 rounded-box z-[1001] m-1 w-64 p-2 shadow-lg",tabindex:"1"},Pe={class:"flex flex-row gap-2 items-center"},Ae=["value"],ze={class:"flex flex-row items-center gap-1 mt-2"},je={class:"flex flex-row gap-2 items-center"},De={class:"label cursor-pointer gap-1"},Re=["checked"],qe={class:"label cursor-pointer gap-1"},Be=["checked"],Le={class:"form-control cursor-pointer"},Ge={class:"label gap-2 p-0 justify-start"},Je=["checked"],We={class:"dropdown w-fit dropdown-end shrink-0 snap-end"},Ue={class:"dropdown-content menu bg-base-200 rounded-box z-[1001] m-1 w-64 p-2 shadow-lg",tabindex:"1"},He={class:"flex flex-row gap-3 items-center"},Ke={class:"flex flex-col gap-1"},Qe={class:"flex flex-row gap-2 flex-wrap items-center"},Xe=["value"],Ye={class:"flex flex-row gap-2 items-center"},Ze=["value"],et={class:"flex flex-row gap-2 items-center"},tt=["value"],st={class:"flex flex-row gap-2 items-center mt-2"},lt={class:"flex flex-row gap-2 items-center hover:bg-base-300 rounded-lg cursor-pointer p-0 pr-1"},nt=["checked"],ot={class:"dropdown w-fit dropdown-end shrink-0 snap-end"},it={class:"dropdown-content menu bg-base-200 rounded-box z-[1001] m-1 w-56 p-2 shadow-lg",tabindex:"1"},at={class:"flex flex-row gap-2 items-center"},rt=["value"],dt={class:"dropdown w-fit dropdown-end shrink-0 snap-end"},ut=["title"],pt={key:0,class:"dropdown-content menu bg-base-200 rounded-box z-[1001] m-1 p-2 shadow-lg",tabindex:"1"},bt={class:"flex flex-col gap-2 items-end"},ct={class:"flex flex-row gap-1 items-center"},mt=["value"],ft={class:"flex flex-row gap-1 items-center"},vt=["value"],xt=["disabled"],gt={class:"flex items-center gap-1 justify-end mt-2.5"},wt={key:1,class:"flex items-center gap-1 bg-base-100 rounded-lg shadow-md p-1"},ht={class:"flex-1 min-w-48"},yt=H({__name:"CarteMapFilters",props:{falaises:{},gares:{},villes:{}},setup(p){const b=p,s=ee();function v(r){const t=r.target;if(!t.matches('[role="button"][tabindex="0"]'))return;const l=t.closest(".dropdown");if(!l)return;const a=l.querySelector(".dropdown-content");if(!a)return;const C=t.getBoundingClientRect(),U=window.innerWidth<768;a.style.position="fixed",a.style.top=`${C.bottom+6}px`,a.style.left="auto",U?a.style.right="34px":a.style.right=`${window.innerWidth-C.right}px`}const h=T(window.innerWidth>=768);K(()=>{document.addEventListener("focusin",v)}),Q(()=>{document.removeEventListener("focusin",v)});function _(){h.value=!0}function I(){h.value=!1}const V=T(!1),F=T(null);function P(){V.value=!0,X(()=>{var r;return(r=F.value)==null?void 0:r.focus()})}function S(){V.value=!1}function A(r){S()}const z=[{id:"N",label:"Nord",hint:"(NO, N, NE)"},{id:"E",label:"Est",hint:"(NE, E, SE)"},{id:"S",label:"Sud",hint:"(SE, S, SO)"},{id:"O",label:"Ouest",hint:"(SO, O, NO)"}],j=[[{id:"40",label:"4 et -"}],[{id:"50",label:"5-"},{id:"59",label:"5+"}],[{id:"60",label:"6-"},{id:"69",label:"6+"}],[{id:"70",label:"7-"},{id:"79",label:"7+"}],[{id:"80",label:"8 et +"}]],D=[{id:"couenne",label:"Couenne"},{id:"grandeVoie",label:"Grandes voies"},{id:"bloc",label:"Bloc"},{id:"psychobloc",label:"Psychobloc"}],R=[{value:0,label:"Pas de minimum"},{value:20,label:"Plus de 20"},{value:50,label:"Plus de 50"},{value:100,label:"Plus de 100"},{value:200,label:"Plus de 200"}],q=m(()=>s.filters.exposition.length>0),B=m(()=>s.filters.cotations.length>0||s.filters.typeVoies.couenne||s.filters.typeVoies.grandeVoie||s.filters.typeVoies.bloc||s.filters.typeVoies.psychobloc||s.filters.nbVoiesMin>0),E=m(()=>s.filters.train.tempsMax!==null||s.filters.train.correspMax!==null||s.filters.train.terOnly),L=m(()=>s.filters.velo.tempsMax!==null||s.filters.velo.distMax!==null||s.filters.velo.denivMax!==null||s.filters.velo.apiedPossible),G=m(()=>s.filters.approche.tempsMax!==null),N=m(()=>s.filters.total.tempsTV!==null||s.filters.total.tempsTVA!==null),d=m(()=>s.filters.villeId!==null);function J(r){return s.filters.exposition.includes(r)}function W(r){return s.filters.cotations.includes(r)}function c(r){const t=parseInt(r,10);return isNaN(t)?null:t}return(r,t)=>(i(),o("div",le,[e("div",ne,[h.value?(i(),o(f,{key:1},[e("div",oe,[e("div",ie,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm md:btn-md text-nowrap focus:pointer-events-none shadow-md border-0",d.value?"btn-primary":"bg-base-100"])}," Ville ðŸ™ï¸ ",2),e("div",ae,[e("div",re,[t[17]||(t[17]=e("div",{class:"font-bold"},"Ville de dÃ©part",-1)),e("select",{class:"select select-sm border-base-300 focus:outline-base-300 w-full",value:n(s).filters.villeId??"",onChange:t[0]||(t[0]=l=>n(s).setVilleId(l.target.value||null))},[t[16]||(t[16]=e("option",{value:""},"Toutes les villes",-1)),(i(!0),o(f,null,g(b.villes,l=>(i(),o("option",{key:l.ville_id,value:l.ville_id},w(l.ville_nom),9,ue))),128))],40,de)])])]),e("div",pe,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm md:btn-md text-nowrap focus:pointer-events-none shadow-md border-0",B.value?"btn-primary":"bg-base-100"])}," Voies ðŸ§—â€â™€ï¸ ",2),e("div",be,[e("div",ce,[e("div",me,[t[19]||(t[19]=e("div",null,[e("span",{class:"font-bold"},"Cotations"),O(" (ex: 5+ ET 6+) ")],-1)),e("div",fe,[(i(),o(f,null,g(j,l=>e("div",{key:l[0].id,class:"flex flex-row gap-4"},[(i(!0),o(f,null,g(l,a=>(i(),o("label",{key:a.id,class:u(["label hover:bg-base-300 rounded-lg cursor-pointer gap-2 p-0 pr-1",{"w-16 justify-start":l.length>1}])},[e("input",{type:"checkbox",checked:W(a.id),class:"checkbox checkbox-primary checkbox-sm",onChange:C=>n(s).toggleCotation(a.id)},null,40,ve),e("span",xe,w(a.label),1)],2))),128))])),64)),t[18]||(t[18]=e("span",{class:"italic text-base-300 text-sm"},"(5- = de 5a Ã  5b, 5+ = de 5b+ Ã  5c+)",-1))])])]),t[20]||(t[20]=e("div",{class:"font-bold"},"Nombre de voies",-1)),e("div",null,[e("label",ge,[e("select",{class:"select border-base-300 select-sm focus:outline-base-300",value:n(s).filters.nbVoiesMin,onChange:t[1]||(t[1]=l=>n(s).setNbVoiesMin(Number(l.target.value)))},[(i(),o(f,null,g(R,l=>e("option",{key:l.value,value:l.value},w(l.label),9,he)),64))],40,we)])]),t[21]||(t[21]=e("div",{class:"font-bold"},"Types de voies",-1)),e("div",ye,[(i(),o(f,null,g(D,l=>e("div",{key:l.id,class:"flex flex-row gap-2 items-center w-full"},[e("label",ke,[e("input",{type:"checkbox",checked:n(s).filters.typeVoies[l.id],class:"checkbox checkbox-primary checkbox-sm",onChange:a=>n(s).setTypeVoie(l.id,!n(s).filters.typeVoies[l.id])},null,40,_e),e("span",Ve,w(l.label),1)])])),64))])])]),e("div",Ce,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm md:btn-md text-nowrap focus:pointer-events-none shadow-md border-0",q.value?"btn-primary":"bg-base-100"])}," Exposition ðŸ”… ",2),e("div",Te,[e("div",Me,[e("div",Fe,[(i(),o(f,null,g(z,l=>e("label",{key:l.id,class:"label hover:bg-base-300 rounded-lg cursor-pointer gap-2 p-0 pr-1 w-full justify-start"},[e("input",{type:"checkbox",checked:J(l.id),class:"checkbox checkbox-primary checkbox-sm",onChange:a=>n(s).toggleExposition(l.id)},null,40,Se),e("span",Ee,[O(w(l.label)+" ",1),e("span",Ne,w(l.hint),1)])])),64))])])])]),e("div",Oe,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm md:btn-md text-nowrap focus:pointer-events-none shadow-md border-0",{"btn-primary":E.value,"bg-base-100":!E.value&&d.value,"bg-base-200 opacity-50":!d.value}]),title:d.value?"Filtrer par train":"SÃ©lectionnez une ville pour filtrer par train"}," Train ðŸšž ",10,$e),d.value?(i(),o("div",Ie,[e("label",Pe,[t[22]||(t[22]=e("div",{class:"font-bold"},"DurÃ©e",-1)),t[23]||(t[23]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.train.tempsMax??"",onInput:t[2]||(t[2]=l=>n(s).setTrainTempsMax(c(l.target.value)))},null,40,Ae),t[24]||(t[24]=e("div",null,"minutes",-1))]),e("div",ze,[t[27]||(t[27]=e("div",null,"Nb. Corresp. Max",-1)),e("div",je,[e("label",De,[e("input",{type:"radio",name:"nbCorrespMax",value:"0",class:"radio radio-primary radio-xs",checked:n(s).filters.train.correspMax===0,onChange:t[3]||(t[3]=l=>n(s).setTrainCorrespMax(0))},null,40,Re),t[25]||(t[25]=e("span",{class:"label-text"},"0",-1))]),e("label",qe,[e("input",{type:"radio",name:"nbCorrespMax",value:"1",class:"radio radio-primary radio-xs",checked:n(s).filters.train.correspMax===1,onChange:t[4]||(t[4]=l=>n(s).setTrainCorrespMax(1))},null,40,Be),t[26]||(t[26]=e("span",{class:"label-text"},"â‰¤1",-1))]),n(s).filters.train.correspMax!==null?(i(),o("button",{key:0,type:"button",class:"btn btn-ghost btn-xs p-0",title:"RÃ©initialiser",onClick:t[5]||(t[5]=l=>n(s).setTrainCorrespMax(null))}," âœ• ")):M("",!0)])]),t[30]||(t[30]=e("div",{class:"divider my-1"},null,-1)),e("label",Le,[e("div",Ge,[t[28]||(t[28]=e("span",{class:"label-text text-sm"},"TGV OK",-1)),e("input",{type:"checkbox",class:"toggle toggle-primary toggle-sm",checked:n(s).filters.train.terOnly,onChange:t[6]||(t[6]=l=>n(s).setTrainTerOnly(!n(s).filters.train.terOnly))},null,40,Je),t[29]||(t[29]=e("span",{class:"label-text text-sm"},"TER uniquement",-1))])])])):M("",!0)]),e("div",We,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm md:btn-md text-nowrap focus:pointer-events-none shadow-md border-0",L.value?"btn-primary":"bg-base-100"])}," VÃ©lo ðŸš² ",2),e("div",Ue,[e("div",He,[t[37]||(t[37]=e("div",null,"Trajet vÃ©lo",-1)),e("div",Ke,[e("label",Qe,[t[31]||(t[31]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.velo.tempsMax??"",onInput:t[7]||(t[7]=l=>n(s).setVeloTempsMax(c(l.target.value)))},null,40,Xe),t[32]||(t[32]=e("div",null,"minutes",-1))]),e("label",Ye,[t[33]||(t[33]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.velo.distMax??"",onInput:t[8]||(t[8]=l=>n(s).setVeloDistMax(c(l.target.value)))},null,40,Ze),t[34]||(t[34]=e("div",null,"km",-1))]),e("label",et,[t[35]||(t[35]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.velo.denivMax??"",onInput:t[9]||(t[9]=l=>n(s).setVeloDenivMax(c(l.target.value)))},null,40,tt),t[36]||(t[36]=e("div",null,"D+",-1))])])]),e("div",st,[t[39]||(t[39]=e("div",{class:"bg-base-100 rounded-full w-6 h-6 border-2 border-base-300 flex items-center justify-center text-xs text-slate-600 font-bold"}," OU ",-1)),e("label",lt,[e("input",{type:"checkbox",checked:n(s).filters.velo.apiedPossible,class:"checkbox border-base-300 bg-base-100",onChange:t[10]||(t[10]=l=>n(s).setVeloApiedPossible(!n(s).filters.velo.apiedPossible))},null,40,nt),t[38]||(t[38]=e("div",null,"Accessible Ã  pied",-1))])])])]),e("div",ot,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm md:btn-md text-nowrap focus:pointer-events-none shadow-md border-0",G.value?"btn-primary":"bg-base-100"])}," Marche ðŸ¥¾ ",2),e("div",it,[e("label",at,[t[40]||(t[40]=e("div",{class:"font-bold"},"Approche",-1)),t[41]||(t[41]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.approche.tempsMax??"",onInput:t[11]||(t[11]=l=>n(s).setApprocheTempsMax(c(l.target.value)))},null,40,rt),t[42]||(t[42]=e("div",null,"minutes",-1))])])]),e("div",dt,[e("div",{tabindex:"0",role:"button",class:u(["btn btn-sm md:btn-md text-nowrap focus:pointer-events-none shadow-md border-0",{"btn-primary":N.value,"bg-base-100":!N.value&&d.value,"bg-base-200 opacity-50":!d.value}]),title:d.value?"Filtrer par temps total":"SÃ©lectionnez une ville pour filtrer par temps total"}," Total â±ï¸ ",10,ut),d.value?(i(),o("div",pt,[e("div",bt,[e("label",ct,[t[43]||(t[43]=e("div",null,"Train+VÃ©lo",-1)),t[44]||(t[44]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.total.tempsTV??"",onInput:t[12]||(t[12]=l=>n(s).setTotalTempsTV(c(l.target.value)))},null,40,mt),t[45]||(t[45]=e("div",null,"minutes",-1))]),e("label",ft,[t[46]||(t[46]=e("div",null,"Train+VÃ©lo+Approche",-1)),t[47]||(t[47]=e("div",{class:"text-normal font-bold"},"â‰¤",-1)),e("input",{type:"number",step:"1",min:"0",class:"input input-sm w-14",value:n(s).filters.total.tempsTVA??"",onInput:t[13]||(t[13]=l=>n(s).setTotalTempsTVA(c(l.target.value)))},null,40,vt),t[48]||(t[48]=e("div",null,"minutes",-1))])])])):M("",!0)])]),e("button",{type:"button",class:"btn btn-sm md:btn-md btn-square bg-base-100 shadow-md border-0 shrink-0",disabled:!n(s).hasActiveFilters,title:"RÃ©initialiser les filtres",onClick:t[14]||(t[14]=l=>n(s).resetFilters())},[x(y,{name:"refresh",class:"w-3 h-3 stroke-2"})],8,xt),e("button",{type:"button",class:"btn btn-sm md:btn-md max-md:btn-square bg-base-100 shadow-md border-0 shrink-0",title:"Fermer les filtres",onClick:I},[t[49]||(t[49]=e("span",{class:"hidden md:inline"},"Filtres",-1)),x(y,{name:"close",class:"w-4 h-4 stroke-2"})])],64)):(i(),o("button",{key:0,type:"button",class:u(["btn btn-sm md:btn-md max-md:btn-square shadow-md border-0",n(s).hasActiveFilters?"btn-primary":"bg-base-100"]),title:"Filtrer les falaises",onClick:_},[t[15]||(t[15]=e("span",{class:"hidden md:inline"},"Filtres",-1)),x(y,{name:"filter",class:"w-4 h-4 stroke-2"})],2))]),e("div",gt,[V.value?(i(),o("div",wt,[e("div",ht,[x(te,{ref_key:"searchRef",ref:F,falaises:b.falaises,gares:b.gares,onSelect:A},null,8,["falaises","gares"])]),e("button",{type:"button",class:"btn btn-sm md:btn-md btn-ghost",title:"Fermer la recherche",onClick:S},[x(y,{name:"close",class:"w-4 h-4 stroke-2"})])])):(i(),o("button",{key:0,type:"button",class:"btn btn-sm md:btn-md max-md:btn-square bg-base-100 shadow-md border-0",title:"Rechercher une falaise ou une gare",onClick:P},[t[50]||(t[50]=e("span",{class:"hidden md:inline"},"Rechercher",-1)),x(y,{name:"search",class:"w-4 h-4 stroke-2"})]))])]))}}),kt=se(yt,[["__scopeId","data-v-9bc10fa0"]]);function $(){const p=document.getElementById("vue-map-filters");if(!p){console.warn("[velogrimpe] #vue-map-filters mount point not found");return}let b=[],s=[],v=[];try{b=JSON.parse(p.dataset.falaises||"[]"),s=JSON.parse(p.dataset.gares||"[]"),v=JSON.parse(p.dataset.villes||"[]"),console.log(`[velogrimpe] Parsed data: ${b.length} falaises, ${s.length} gares, ${v.length} villes`)}catch(_){console.error("[velogrimpe] Failed to parse data from PHP:",_)}const k=Y(kt,{falaises:b,gares:s,villes:v}),h=Z();k.use(h),k.mount(p),console.log("[velogrimpe] Vue map filters app mounted")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$):setTimeout($,0);
